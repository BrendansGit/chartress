window.chartress=function(s,e){function a(s,e){return e-s}var t={};"undefined"!=typeof jQuery&&s instanceof jQuery&&(s=s[0]);var l=s;t.o=e,t.s={},t.log=function(s){t.o.debug===!0&&console.log(s)},t.clear=function(){t.draw.clear()};for(var i=function(s){return getComputedStyle(s)},o=function(s){return"undefined"==typeof s},r=[["maxLength",null],["yMax",0],["fontFamily","Helvetica"],["class","chartress"],["type","line"],["graph"],["graph.padding"],["graph.padding.left",0],["graph.padding.right",0],["graph.padding.top",0],["graph.padding.bottom",0],["graph.redrawTimeout",5],["xAxis"],["xAxis.visible",!0],["xAxis.range"],["xAxis.range.from",0],["xAxis.range.to",null],["xAxis.legend"],["xAxis.legend.x"],["xAxis.legend.y"],["xAxis.lines"],["xAxis.lines.visible",!1],["xAxis.lines.color","rgba(0,0,0,.1)"],["xAxis.lines.width",1],["xAxis.label"],["xAxis.label.format",function(s){return s}],["xAxis.label.fontSize",14],["xAxis.label.markEvery",1],["xAxis.label.markCount",null],["xAxis.label.color","gray"],["xAxis.label.y",0],["xAxis.label.position","bottom"],["xAxis.label.size",14],["yAxis"],["yAxis.visible",!0],["yAxis.lines"],["yAxis.lines.visible",!0],["yAxis.lines.color","rgba(0,0,0,.1)"],["yAxis.lines.width",1],["yAxis.label"],["yAxis.label.format",function(s){return s}],["yAxis.label.fontSize",14],["yAxis.label.markEvery",null],["yAxis.label.markCount",4],["yAxis.label.color","gray"],["yAxis.label.x",0],["legend"],["legend.x",100],["legend.y",0],["legend.padding"],["legend.padding.top",0],["legend.padding.right",0],["legend.padding.bottom",0],["legend.padding.left",0],["columns"],["columns.width",40],["columns.space",1],["columns.labels"],["columns.labels.fontSize",16],["columns.labels.y",1],["pie"],["pie.total",null],["pie.title"],["pie.title.size",50],["pie.title.bold",!0],["pie.title.text",!1],["pie.title.pre"],["pie.title.pre.text",!1],["pie.title.pre.size",14],["pie.title.sub"],["pie.title.sub.text",!1],["pie.title.sub.size",14]],n=0;n<r.length;n++){var d=r[n][0].split("."),p={};o(r[n][1])||(p=r[n][1]);t.o;1===d.length&&(o(t.o[d[0]])?(t.o[d[0]]=p,t.s[d[0]]=p):t.s[d[0]]=t.o[d[0]]),2===d.length&&(o(t.o[d[0]][d[1]])?(t.o[d[0]][d[1]]=p,t.s[d[0]][d[1]]=p):t.s[d[0]][d[1]]=t.o[d[0]][d[1]]),3===d.length&&(o(t.o[d[0]][d[1]][d[2]])?(t.o[d[0]][d[1]][d[2]]=p,t.s[d[0]][d[1]][d[2]]=p):t.s[d[0]][d[1]][d[2]]=t.o[d[0]][d[1]][d[2]])}"line"===t.s.type&&(t.s.graph.padding={top:t.o.graph.padding.top||10,right:t.o.graph.padding.right||8,bottom:t.o.graph.padding.bottom||25,left:t.o.graph.padding.left||35}),"column"===t.s.type&&(t.s.graph.padding={top:t.o.graph.padding.top||25,right:t.o.graph.padding.right||0,bottom:t.o.graph.padding.bottom||25,left:t.o.graph.padding.left||35},t.s.xAxis.label.pos=t.o.xAxis.label.position||"top",t.s.xAxis.label.y=t.o.xAxis.label.y||-5);var g=document.createElement("div");l.appendChild(g),g.className=t.s["class"],g.style.height="100%",g.style.width="100%",t.draw=SVG(g).size("100%","100%").spof(),t.o.debug===!0&&(console.info("chartress debug enabled for "),console.info(g),console.info("Passed Data: "),console.info(t.o),console.log("------")),t.setBounds=function(){if("line"===t.s.type||"column"==t.s.type){var s=0;for(var e in t.o.dataset)!function(){var l=t.o.dataset[e],i=l.plot.slice(0);null!==t.s.maxLength&&i.length>t.s.maxLength&&(i.reverse(),i.length=t.s.maxLength,i.reverse()),i.length>s&&(s=i.length),l.__plot=i.slice(0),i.sort(a),t.s.yMax<i[0]&&(t.s.yMax=i[0])}();t.s.maxLength=s,null===t.s.xAxis.range.to&&(t.s.xAxis.range.to=s)}if("column"===t.s.type){t.s.largestcolumn=0;for(var e in t.o.dataset)for(var l=t.o.dataset[e],o=0;o<l.__plot.length;o++){var r=l.__plot[o];t.s.largestcolumn<r&&(t.s.largestcolumn=r)}}if("pie"===t.s.type&&(t.s.pie.total=t.o.pie.total||!1,t.s.pie.total===!1))for(var e in t.o.dataset){var l=t.o.dataset[e];t.s.pie.total+=l.value}t.s.outerWidth=parseInt(i(g).width),t.s.width=t.s.outerWidth-t.s.graph.padding.right-t.s.graph.padding.left,t.s.outerHeight=parseInt(i(g).height),t.s.height=t.s.outerHeight-t.s.graph.padding.top-t.s.graph.padding.bottom,t.s.rect={top:t.s.graph.padding.top,left:t.s.graph.padding.left,right:t.s.graph.padding.left+t.s.width,bottom:t.s.outerHeight-t.s.graph.padding.bottom},t.o.debug===!0},t.drawLabels=function(){null===t.s.yAxis.label.markEvery&&(t.s.yAxis.label.markEvery=Math.round(t.s.yMax/t.s.yAxis.label.markCount));var s,e=[];for(s=0;s<t.s.yMax+t.s.yAxis.label.markEvery;s++){var a=s%t.s.yAxis.label.markEvery;0===a&&s<=t.s.yMax&&e.push(s)}if(e[e.length-1]=t.s.yMax,t.s.yAxis.visible!==!1||t.s.yAxis.lines.visible!==!1)for(t.yLabels=t.draw.group().addClass(t.s["class"]+"__labels chartress__labels--yAxis"),t.yLines=t.draw.group().addClass(t.s["class"]+"__lines chartress__lines--yAxis"),t.s.yPoints=[],s=0;s<e.length;s++)!function(){var a=(1-e[s]/t.s.yMax*t.s.height)*-1+t.s.graph.padding.top,l=t.s.yAxis.label.fontSize;if(t.s.yAxis.lines.visible!==!1&&t.yLines.rect(t.s.width,t.s.yAxis.lines.width).fill(t.s.yAxis.lines.color).dy(a).dx(t.s.rect.left),t.s.yAxis.visible!==!1){var o=e[e.length-1-s];o=t.s.yAxis.label.format(o),o=o.toString();var r=t.yLabels.text(o).fill(t.s.yAxis.label.color).font({family:t.s.fontFamily,size:l}).dx(t.s.rect.left+t.s.yAxis.label.x).dy(a-l/3).addClass(t.s["class"]+"__labels__label chartress__labels__label--yAxis");r.dx(parseInt(i(r.node).width)*-1-10),r.dy(parseInt(i(r.node).height)/2*-1),t.s.yPoints.push(a-l/3)}}();var l=(t.s.longestLine,t.s.xAxis.range.to-t.s.xAxis.range.from);null!==t.s.maxLength&&(l=t.s.maxLength),t.s.xPoints=[];var o=0;if("column"===t.s.type&&(l++,o=t.s.width/l/2),t.s.xAxis.visible!==!1||t.s.xAxis.lines.visible!==!1){var r=0;for(t.s.xAxis.maxRangeLength&&(r=t.s.xAxis.maxRangeLength+1),t.xLabels=t.draw.group().addClass(t.s["class"]+"__labels chartress__labels--xAxis"),t.xLines=t.draw.group().addClass(t.s["class"]+"__lines chartress__lines--xAxis"),s=0;s<l;s++)!function(){var e=t.s.xAxis.range.from+s+r;e=t.s.xAxis.label.format(e),e=e.toString();var a=s/(l-1),i=t.s.width*a+t.s.graph.padding.left,n=t.s.rect.bottom+t.s.xAxis.label.y;"top"===t.s.xAxis.label.pos&&(n=t.s.rect.top-1.5*t.s.xAxis.label.size+t.s.xAxis.label.y),t.s.xAxis.lines.visible!==!1&&t.xLines.rect(t.s.xAxis.lines.width,t.s.height).fill(t.s.xAxis.lines.color).dx(i-Math.ceil(t.s.xAxis.lines.width/2)+1).dy(t.s.rect.top),s%t.s.xAxis.label.markEvery===0&&t.s.xAxis.visible!==!1&&t.xLabels.text(e).fill(t.s.xAxis.label.color).font({family:t.s.fontFamily,anchor:"middle",size:t.s.xAxis.label.fontSize}).dx(i+o).dy(n).addClass(t.s["class"]+"__labels__label chartress__labels--xAxis"),t.s.xPoints.push(i)}()}},t.drawLines=function(){t.draw_plots=t.draw.group().addClass(t.s["class"]+"__plots");for(var s in t.o.dataset){var e=t.o.dataset[s],a=e.classname||e.name.toLowerCase().replace(/ /g,"_"),l=e.color||"black",i=e.width||2,o=[];e.__plotgroup=t.draw_plots.group(),e.__plotgroup.addClass(t.s["class"]+"__plot chartress__plot--"+a).attr("plot-name",a);var r=0;for(var s in e.__plot)!function(){var a=e.__plot[s],l=r/(t.s.maxLength-1)*t.s.width+t.s.graph.padding.left,i=a/t.s.yMax*t.s.height;i=t.s.height-i+t.s.graph.padding.top,o.push([l,i]),r++}();e.__plotsvg=e.__plotgroup.polyline(o).fill("none").stroke({color:l,width:i}).addClass(t.s["class"]+"__line chartress__line--"+a),e.dash&&e.__plotsvg.attr("stroke-dasharray",e.dash);var n=e.rad||6;for(var s in o)!function(){var r=o[s];e.__plotgroup.circle(n).dx(r[0]-n/2).dy(r[1]-n/2).addClass(t.s["class"]+"__dot chartress__dot--"+a).stroke({color:l,width:i}).fill("white")}()}},t.drawColumns=function(){t.draw_columns=[];for(var s=t.s.maxLength,e=t.s.width/s,a=0;a<s;a++){t.draw_columns[a]=t.draw.group().addClass(t.s["class"]+"__columns__group "+t.s["class"]+"__columns__group--"+a);var l=e*a+t.s.graph.padding.left,i=t.s.columns.labels.y,o=0;for(var r in t.o.dataset){var n=t.o.dataset[r];t.log(n);var d=n.name||(a+1).toString();"object"==typeof d&&(d=d[a]);var p=n.color||"#222",g=n.textColor||p,h=n.classname||d.replace(/ /g,"_").toLowerCase(),x=t.s.columns.width,c=t.s.columns.space,_=n.__plot[a]/t.s.largestcolumn*t.s.height,f=t.o.dataset.length*-.5+.5+o,u=f*(x+c);t.log([f,u]),t.draw_columns[a].text(d).fill(g).dx(l+e/2+u).dy(t.s.height+i+t.s.graph.padding.top).font({family:t.s.fontFamily,anchor:"middle",size:t.s.columns.labels.fontsize}).addClass(t.s["class"]+"__columns__label "+t.s["class"]+"__columns__label--"+h),t.draw_columns[a].rect(x,_).fill(p).dx(l+e/2+u-x/2).dy(t.s.height-_+t.s.graph.padding.top).addClass(t.s["class"]+"__columns__column "+t.s["class"]+"__columns__column--"+h),o++}}},t.drawPies=function(){var s=0;t.pies={},t.draw_pie=t.draw.group().addClass(t.s["class"]+"__pies");var e=t.s.width<t.s.height?t.s.width:t.s.height,a=t.s.width/2-e/2+t.s.rect.left,l=t.s.height/2-e/2+t.s.rect.top,i=t.s.pie.total,o=0;if(null===i){i=0;for(var r in t.o.dataset){var n=t.o.dataset[r];i+=n.value}}var d;for(var r in t.o.dataset)!function(){var n=t.o.dataset[r],p=200-10*s,g="rgb("+p+","+p+","+p+")",h=!1;"object"==typeof n.color&&(h=t.draw_pie.gradient("radial",function(s){s.at(0,n.color[0]),s.at(1,n.color[1])}),h.from("50%","50%").to("50%","50%").radius("5%"));var x=0,c=-90+x;"number"==typeof n.position?(n.position>1&&(n.position=n.position/100),x=360*n.position):0!==o&&(x=o/i*360),"number"!=typeof n.position&&(o+=n.value),c=-90+x;var _=n.classname||"noclass-"+s,f=e;"undefined"!=typeof n.width&&(f=n.width),sliceMask=t.draw_pie.circle(e),sliceMask.fill("transparent").addClass(t.s["class"]+"__pie").dx(a).dy(l).stroke({width:f,color:"white"});var u=2*Math.PI*(e/2);sliceMask.rotate(c),d=t.draw_pie.circle(e).fill({color:"white"}).dx(a).dy(l),sliceMask.maskWith(d);var m=n.value*u/i;sliceMask.attr("stroke-dasharray",m+","+u),t.pies[_]=t.draw_pie.circle(e).fill(n.color||g).dx(a).dy(l),h&&t.pies[_].fill(h),t.pies[_].maskWith(sliceMask),s++}();var p=t.s.pie.title;if(p.text!==!1){t.draw_pie_title=t.draw_pie.group().addClass(t.s["class"]+"__pie__title");var g=t.draw_pie_title.text(p.text).addClass(t.s["class"]+"__pie__title--main").font({family:t.s.fontFamily,size:p.size,anchor:"middle"}).dx(t.s.width/2+t.s.graph.padding.left).dy(t.s.height/2+t.s.graph.padding.top-.9*p.size);p.bold&&g.font({family:t.s.fontFamily,weight:"bold"});var h=p.pre;p.pre.text&&(pretext=t.draw_pie_title.text(h.text).addClass(t.s["class"]+"__pie__title--pre").font({family:t.s.fontFamily,size:h.size,anchor:"middle"}).dx(t.s.width/2+t.s.graph.padding.left).dy(t.s.height/2-p.size/2-h.size-5+t.s.graph.padding.top));var x=p.sub;p.sub.text&&(subText=t.draw_pie_title.text(x.text).addClass(t.s["class"]+"__pie__title--sub").font({family:t.s.fontFamily,size:x.size,anchor:"middle"}).dx(t.s.width/2+t.s.graph.padding.left).dy(t.s.height/2+p.size/2.5+t.s.graph.padding.top))}},t.drawLegend=function(){t.draw_legend=t.draw.group().addClass(t.s["class"]+"__legend").font({family:t.s.fontFamily,size:12});var s=0,e=t.s.outerWidth/100*t.s.legend.x;t.s.legend.x>50?(e-=t.s.legend.padding.right,s=t.s.legend.padding.right*-1):(e+=t.s.legend.padding.left,s=t.s.legend.padding.left);var a=0,l=t.s.outerHeight/100*t.s.legend.y;t.s.legend.y<50?(l+=t.s.legend.padding.top,a=t.s.legend.padding.top):(l-=t.s.legend.padding.bottom,a=t.s.legend.padding.bottom*-1),t.draw_legend.width(t.s.outerWidth).dmove(e,l);var o=0;for(var r in t.o.dataset)!function(){var s=t.o.dataset[r];if(s.name){var e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),a=s.color||"black",l=s.width||2;s.__legend=t.draw_legend.group().addClass(t.s["class"]+"__legend__row chartress__legend--"+e).attr("plot-name",e);var n=s.name,d=s.__legend.text(n).fill(a).font({family:t.s.fontFamily}),p=(parseInt(i(d.node).width)+40)*-1-5,g=parseInt(i(d.node).height)*o-9;d.dx(p),d.dy(g);var h=s.rad||6,x=parseInt(i(d.node).height)/2+1,c=parseInt(i(d.node).height)*o+x,_=[[-35,c],[-5,c]],f=s.__legend.polyline(_).fill("none").stroke({color:a,width:l}).addClass(t.s["class"]+"__line chartress__legend__line chartress__legend__line--"+e);s.dash&&f.attr("stroke-dasharray",s.dash),s.__legend.circle(h).stroke({width:l,color:a}).fill("white").dx(0-h/2-5).dy(c-h/2).addClass(t.s["class"]+"__dot chartress__legend__dot--"+e),s.__legend.mouseover(function(){s.__plotgroup.addClass(t.s["class"]+"__plot--hover")}).mouseout(function(){s.__plotgroup.removeClass(t.s["class"]+"__plot--hover")}),o++}}()},t.drawChart=function(){t.clear(),t.setBounds(),"line"===t.s.type&&(t.drawLabels(),t.drawLines(),t.drawLegend()),"column"===t.s.type&&(t.drawLabels(),t.drawColumns()),"pie"===t.s.type&&t.drawPies(),setTimeout(function(){t.draw.spof()})},t.canvasResize=function(){t.drawChart(),t.draw.spof()};var h,x=[parseInt(i(g).width),parseInt(i(g).height)];return SVG.on(window,"resize",function(){x[0]===parseInt(i(g).width)&&x[1]===parseInt(i(g).height)||(clearTimeout(h),h=setTimeout(t.canvasResize,t.s.graph.redrawTimeout))}),t.drawToCanvas=function(e){var a=s.querySelector("svg"),l=e.getContext("2d");l.canvas.width=t.s.outerWidth,l.canvas.height=t.s.outerHeight;var i=new Image,o=(new XMLSerializer).serializeToString(a),r=btoa(o),n="data:image/svg+xml;base64,",d=n+r;i.src=d,l.drawImage(i,0,0)},t.drawChart(),t};