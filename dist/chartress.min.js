window.chartress=function(t,s){function e(t,s){return s-t}var i=t;"undefined"!=typeof jQuery&&t instanceof jQuery&&(i=i[0]);var n={};n.options=s,n.draw=SVG(i).size("100%","100%").spof(),n.clear=function(){n.draw.clear()},"undefined"==typeof n.options.graph&&(n.options.graph={}),"undefined"==typeof n.options.xAxis&&(n.options.xAxis={}),"undefined"==typeof n.options.xAxis.range&&(n.options.xAxis.range={}),"undefined"==typeof n.options.xAxis.legend&&(n.options.xAxis.legend={}),"undefined"==typeof n.options.yAxis&&(n.options.yAxis={}),"undefined"==typeof n.options.yAxis.label&&(n.options.yAxis.label={}),"undefined"==typeof n.options.legend&&(n.options.legend={}),"undefined"==typeof n.options.xAxis.label&&(n.options.xAxis.label={}),"undefined"==typeof n.options.xAxis.label.format&&(n.options.xAxis.label.format=function(t){return t}),"undefined"==typeof n.options.legend.padding&&(n.options.legend.padding={}),"undefined"==typeof n.options.graph.padding&&(n.options.graph.padding={}),"undefined"==typeof n.options.columns&&(n.options.columns={}),"undefined"==typeof n.options.columns.labels&&(n.options.columns.labels={}),"undefined"==typeof n.options.pie&&(n.options.pie={}),"undefined"==typeof n.options.pie.title&&(n.options.pie.title={});var o=function(t){return getComputedStyle(t)},a=n.options.xAxis.maxRangeLength||1/0;n.settings={yMax:0,fontSize:n.options.graph.fontFamily||"Helvetica","class":n.options.graph.class_prefix||"chartress",padding:{top:n.options.graph.padding.top||0,right:n.options.graph.padding.right||0,bottom:n.options.graph.padding.bottom||0,left:n.options.graph.padding.left||0},type:n.options.type||"line",yAxis:{markEvery:n.options.yAxis.markEvery||1,label:{color:n.options.yAxis.label.color||"gray",x:n.options.yAxis.label.x||0},markEvery:n.options.yAxis.markEvery||20},xAxis:{range:{from:n.options.xAxis.range.from||0,to:n.options.xAxis.range.to||null},markEvery:n.options.xAxis.markEvery||1,label:{color:n.options.xAxis.label.color||"gray",y:n.options.xAxis.label.y||0}},legend:{x:n.options.legend.x||100,y:n.options.legend.x||0,padding:{top:n.options.legend.padding.top||0,right:n.options.legend.padding.right||0,bottom:n.options.legend.padding.bottom||0,left:n.options.legend.padding.left||0}},columns:{width:n.options.columns.width||15,labels:{fontSize:n.options.columns.labels.fontSize||16,y:n.options.columns.labels.y||1}},pie:{total:n.options.pie.total||100,red:"blue",title:{size:n.options.pie.title.size||50,bold:n.options.pie.title.bold||!0,text:n.options.pie.title.text||!1,pre:n.options.pie.title.pre||!1,sub:n.options.pie.title.sub||!1}}},"line"===n.settings.type&&(n.settings.padding={top:n.options.graph.padding.top||10,right:n.options.graph.padding.right||8,bottom:n.options.graph.padding.bottom||25,left:n.options.graph.padding.left||35}),"column"===n.settings.type&&(n.settings.padding={top:n.options.graph.padding.top||0,right:n.options.graph.padding.right||0,bottom:n.options.graph.padding.bottom||25,left:n.options.graph.padding.left||0}),n.setBounds=function(){if("line"===n.settings.type){var t=0;for(var s in n.options.lines)!function(){var i=n.options.lines[s],o=i.plot.slice(0);o.length>a&&(o.reverse(),o.length=a,o.reverse()),o.length>t&&(t=o.length-1),i.__plot=o.slice(0),o.sort(e),n.settings.yMax<o[0]&&(n.settings.yMax=o[0])}();null===n.settings.xAxis.range.to&&(n.settings.xAxis.range.to=t)}if("column"===n.settings.type){n.settings.largestcolumn=0;for(var s in n.options.lines){var l=n.options.lines[s];n.settings.largestcolumn<l.value&&(n.settings.largestcolumn=l.value)}}if("pie"===n.settings.type&&(n.settings.pie.total=n.options.pie.total||!1,n.settings.pie.total===!1))for(var s in n.options.lines){var l=n.options.lines[s];n.settings.pie.total+=l.value}n.settings.outerWidth=parseInt(o(i).width),n.settings.width=n.settings.outerWidth-n.settings.padding.right-n.settings.padding.left,n.settings.outerHeight=parseInt(o(i).height),n.settings.height=n.settings.outerHeight-n.settings.padding.top-n.settings.padding.bottom,n.settings.rect={top:n.settings.padding.top,left:n.settings.padding.left,right:n.settings.padding.left+n.settings.width,bottom:n.settings.outerHeight-n.settings.padding.bottom}},n.drawLabels=function(){var t,s=[];for(t=0;t<n.settings.yMax+n.settings.yAxis.markEvery;t++)t%n.settings.yAxis.markEvery===0&&s.push(t);for(n.yLabels=n.draw.group().addClass(n.settings["class"]+"__labels chartress__labels--yAxis"),n.settings.yPoints=[],t=0;t<s.length;t++)!function(){var e=(1-s[t]/n.settings.yMax*n.settings.height)*-1+n.settings.padding.top,i=14;e-=i/3;var a=s[s.length-1-t];if(0!==a){var l=n.yLabels.text(a.toString()).fill(n.settings.yAxis.label.color).font({family:n.settings.fontFamily,size:i}).dx(n.settings.rect.left+n.settings.yAxis.label.x).dy(e).addClass(n.settings["class"]+"__labels__label chartress__labels__label--yAxis");l.dx(parseInt(o(l.node).width)*-1-10),l.dy(parseInt(o(l.node).height)/2*-1),n.settings.yPoints.push(e)}}();var e=(n.settings.longestLine,n.settings.xAxis.range.to-n.settings.xAxis.range.from);for(n.settings.xPoints=[],n.xLabels=n.draw.group().addClass(n.settings["class"]+"__labels chartress__labels--xAxis"),t=0;t<=e;t++)!function(){var s=n.settings.xAxis.range.from+t;s=n.options.xAxis.label.format(s),s=s.toString();var i=t/e,o=n.settings.width*i+n.settings.padding.left;t%n.settings.xAxis.markEvery===0&&(console.log(t),n.xLabels.text(s).fill(n.settings.xAxis.label.color).font({family:n.settings.fontFamily,anchor:"middle",size:14}).dx(o).dy(n.settings.rect.bottom+n.settings.xAxis.label.y).addClass(n.settings["class"]+"__labels__label chartress__labels--xAxis")),n.settings.xPoints.push(o)}()},n.drawLines=function(){n.draw_plots=n.draw.group().addClass(n.settings["class"]+"__plots");for(var t in n.options.lines){var s=n.options.lines[t],e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),i=s.color||"black",o=s.width||2,a=0,l=[];s.__plotgroup=n.draw_plots.group(),s.__plotgroup.addClass(n.settings["class"]+"__plot chartress__plot--"+e).attr("plot-name",e);for(var t in s.__plot)!function(){var e=s.__plot[t],i=n.settings.xPoints[a],o=e/n.settings.yMax*n.settings.height;o=n.settings.height-o+n.settings.padding.top,l.push([i,o]),a++}();s.__plotsvg=s.__plotgroup.polyline(l).fill("none").stroke({color:i,width:o}).addClass(n.settings["class"]+"__line chartress__line--"+e),s.dash&&s.__plotsvg.attr("stroke-dasharray",s.dash);var d=s.rad||6;for(var t in l)!function(){var a=l[t];s.__plotgroup.circle(d).dx(a[0]-d/2).dy(a[1]-d/2).addClass(n.settings["class"]+"__dot chartress__dot--"+e).stroke({color:i,width:o}).fill("white")}()}},n.drawLegend=function(){n.draw_legend=n.draw.group().addClass(n.settings["class"]+"__legend").font({family:n.settings.fontFamily,size:12});var t=0,s=n.settings.outerWidth/100*n.settings.legend.x;n.settings.legend.x>50?(s-=n.settings.legend.padding.right,t=n.settings.legend.padding.right*-1):(s+=n.settings.legend.padding.left,t=n.settings.legend.padding.left);var e=0,i=n.settings.outerHeight/100*n.settings.legend.y;n.settings.legend.y<50?(i+=n.settings.legend.padding.top,e=n.settings.legend.padding.top):(i-=n.settings.legend.padding.bottom,e=n.settings.legend.padding.bottom*-1),n.draw_legend.width(n.settings.outerWidth).dmove(s,i);var a=0;for(var l in n.options.lines)!function(){var t=n.options.lines[l];if(t.name){var s=t.classname||t.name.toLowerCase().replace(/ /g,"_"),e=t.color||"black",i=t.width||2;t.__legend=n.draw_legend.group().addClass(n.settings["class"]+"__legend__row chartress__legend--"+s).attr("plot-name",s);var d=t.name,g=t.__legend.text(d).fill(e).font({family:n.settings.fontFamily}),r=(parseInt(o(g.node).width)+40)*-1-5,p=parseInt(o(g.node).height)*a-9;g.dx(r),g.dy(p);var _=t.rad||6,h=parseInt(o(g.node).height)/2+1,c=parseInt(o(g.node).height)*a+h,f=[[-35,c],[-5,c]],u=t.__legend.polyline(f).fill("none").stroke({color:e,width:i}).addClass(n.settings["class"]+"__line chartress__legend__line chartress__legend__line--"+s);t.dash&&u.attr("stroke-dasharray",t.dash),t.__legend.circle(_).stroke({width:i,color:e}).fill("white").dx(0-_/2-5).dy(c-_/2).addClass(n.settings["class"]+"__dot chartress__legend__dot--"+s),t.__legend.mouseover(function(){t.__plotgroup.addClass(n.settings["class"]+"__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass(n.settings["class"]+"__plot--hover")}),a++}}()},n.drawColumns=function(){n.draw_columns=[];var t=0;for(var s in n.options.lines)!function(){var e=n.options.lines[s],i=e.classname||e.name.replace(/ /g,"_").toLowerCase();n.draw_columns[t]=n.draw.group().addClass(n.settings["class"]+"__columns__group "+n.settings["class"]+"__columns__group--"+i);var o=e.color||"#222",a=e.textColor||o,l=100/n.options.lines.length/100*t,d=n.settings.width/n.options.lines.length,g=l*n.settings.width+d-d/2,r=n.settings.columns.width,p=e.value/n.settings.largestcolumn*n.settings.height,_=n.settings.columns.labels.y;n.draw_columns[t].text(e.name).fill(a).font({family:n.settings.fontFamily,anchor:"middle",size:n.settings.columns.labels.fontsize}).dx(g+n.settings.padding.left).dy(n.settings.height+_+n.settings.padding.top).addClass(n.settings["class"]+"__columns__label "+n.settings["class"]+"__columns__label--"+i),n.draw_columns[t].rect(r,p).dx(g-r/2+n.settings.padding.left).dy(n.settings.height-p+n.settings.padding.top).fill(o).addClass(n.settings["class"]+"__columns__column "+n.settings["class"]+"__columns__column--"+i),t++}()},n.drawPies=function(){var t=0;n.pies={},n.draw_pie=n.draw.group().addClass(n.settings["class"]+"__pies");var s=n.settings.width<n.settings.height?n.settings.width:n.settings.height,e=n.settings.width/2-s/2+n.settings.rect.left,i=n.settings.height/2-s/2+n.settings.rect.top,o=n.options.pie.total||"count",a=0;if("count"===o){o=0;for(var l in n.options.lines){var d=n.options.lines[l];o+=d.value}}var g;for(var l in n.options.lines)!function(){var d=n.options.lines[l],r=0,p=-90+r;"number"==typeof d.position?(d.position>1&&(d.position=d.position/100),r=360*d.position):0!==a&&(r=a/o*360),"number"!=typeof d.position&&(a+=d.value),p=-90+r;var _=d.classname||"noclass-"+t,h=s;"undefined"!=typeof d.width&&(h=d.width),n.pies[_]={},n.pies[_].el=n.draw_pie.circle(s),n.pies[_].el.attr("stroke-dasharray","20,10").fill("transparent").addClass(n.settings["class"]+"__pie").dx(e).dy(i).stroke({width:h,color:d.color||"#aaa"});var c=2*Math.PI*(s/2);n.pies[_].el.attr("stroke-dasharray","0,"+c),n.pies[_].el.rotate(p),d.mask!==!1&&(g=n.draw_pie.circle(s).fill({color:"white"}).dx(e).dy(i),n.pies[_].el.maskWith(g)),n.pies[_].set=function(t){var s=t*c/o;n.pies[_].el.attr("stroke-dasharray",s+","+c)},setTimeout(function(){n.pies[_].set(d.value),n.pies[_].el.addClass(n.settings["class"]+"__pie--"+_)}),t++}();var r=n.settings.pie.title||!1;if(r.text!==!1){n.draw_pie_title=n.draw_pie.group().addClass(n.settings["class"]+"__pie__title");var p=n.draw_pie_title.text(r.text).addClass(n.settings["class"]+"__pie__title--main").font({family:n.settings.fontFamily,size:r.size,anchor:"middle"}).dx(n.settings.width/2+n.settings.padding.left).dy(n.settings.height/2+n.settings.padding.top-.9*r.size);r.bold&&p.font({family:n.settings.fontFamily,weight:"bold"});var _=r.pre||!1;_&&(pretext=n.draw_pie_title.text(_.text).addClass(n.settings["class"]+"__pie__title--pre").font({family:n.settings.fontFamily,size:_.size,anchor:"middle"}).dx(n.settings.width/2+n.settings.padding.left).dy(n.settings.height/2-r.size/2-_.size-5+n.settings.padding.top));var h=r.sub||!1;h&&(subText=n.draw_pie_title.text(h.text).addClass(n.settings["class"]+"__pie__title--sub").font({family:n.settings.fontFamily,size:h.size,anchor:"middle"}).dx(n.settings.width/2+n.settings.padding.left).dy(n.settings.height/2+r.size/2.5+n.settings.padding.top))}},n.drawChart=function(){n.clear(),n.setBounds(),"line"===n.settings.type&&(n.drawLabels(),n.drawLines(),n.drawLegend()),"column"===n.settings.type&&n.drawColumns(),"pie"===n.settings.type&&n.drawPies(),setTimeout(function(){n.draw.spof()})},n.canvasResize=function(){n.draw.spof(),n.drawChart()};var l,d=[parseInt(o(i).width),parseInt(o(i).height)];return SVG.on(window,"resize",function(){d[0]===parseInt(o(i).width)&&d[1]===parseInt(o(i).height)||(clearTimeout(l),l=setTimeout(n.canvasResize,n.options.graph.redrawTimeout||0))}),n.drawToCanvas=function(s){var e=t.querySelector("svg"),i=s.getContext("2d");i.canvas.width=n.settings.outerWidth,i.canvas.height=n.settings.outerHeight;var o=new Image,a=(new XMLSerializer).serializeToString(e),l=btoa(a),d="data:image/svg+xml;base64,",g=d+l;o.src=g,i.drawImage(o,0,0)},n.drawChart(),n};