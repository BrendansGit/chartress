window.chartress=function(t,e){function s(t,e){return e-t}var i=t;"undefined"!=typeof jQuery&&t instanceof jQuery&&(i=i[0]);var n={};n.options=e,n.draw=SVG(i).size("100%","100%").spof(),n.clear=function(){n.draw.clear()},"undefined"==typeof n.options.graph&&(n.options.graph={}),"undefined"==typeof n.options.xAxis&&(n.options.xAxis={}),"undefined"==typeof n.options.xAxis.range&&(n.options.xAxis.range={}),"undefined"==typeof n.options.xAxis.legend&&(n.options.xAxis.legend={}),"undefined"==typeof n.options.yAxis&&(n.options.yAxis={}),"undefined"==typeof n.options.yAxis.label&&(n.options.yAxis.label={}),"undefined"==typeof n.options.legend&&(n.options.legend={}),"undefined"==typeof n.options.xAxis.label&&(n.options.xAxis.label={}),"undefined"==typeof n.options.xAxis.format&&(n.options.xAxis.format=function(t){return t}),"undefined"==typeof n.options.legend.padding&&(n.options.legend.padding={}),"undefined"==typeof n.options.graph.padding&&(n.options.graph.padding={}),"undefined"==typeof n.options.columns&&(n.options.columns={}),"undefined"==typeof n.options.columns.labels&&(n.options.columns.labels={}),"undefined"==typeof n.options.pie&&(n.options.pie={}),"undefined"==typeof n.options.pie.title&&(n.options.pie.title={});var o=n.options.xAxis.maxRangeLength||1/0;n.settings={yMax:0,padding:{top:n.options.graph.padding.top||10,right:n.options.graph.padding.right||8,bottom:n.options.graph.padding.bottom||25,left:n.options.graph.padding.left||35},type:n.options.type||"normal",yAxis:{markEvery:n.options.yAxis.markEvery||1,label:{color:n.options.yAxis.label.color||"gray",x:n.options.yAxis.label.x||0},markEvery:n.options.yAxis.markEvery||20},xAxis:{range:{from:n.options.xAxis.range.from||0,to:n.options.xAxis.range.to||null},markEvery:n.options.xAxis.markEvery||1,label:{color:n.options.xAxis.label.color||"gray",y:n.options.xAxis.label.y||0}},legend:{x:n.options.legend.x||100,y:n.options.legend.x||0,padding:{top:n.options.legend.padding.top||0,right:n.options.legend.padding.right||0,bottom:n.options.legend.padding.bottom||0,left:n.options.legend.padding.left||0}},columns:{width:n.options.columns.width||15,labels:{fontSize:n.options.columns.labels.fontSize||16,y:n.options.columns.labels.y||1}},pie:{total:n.options.pie.total||100,red:"blue",title:{size:n.options.pie.title.size||50,bold:n.options.pie.title.bold||!0,text:n.options.pie.title.text||!1}}},n.setBounds=function(){if("normal"===n.settings.type){var t=0;for(var e in n.options.lines)!function(){var i=n.options.lines[e],a=i.plot.slice(0);a.length>o&&(a.reverse(),a.length=o,a.reverse()),a.length>t&&(t=a.length-1),i.__plot=a.slice(0),a.sort(s),n.settings.yMax<a[0]&&(n.settings.yMax=a[0])}();null===n.settings.xAxis.range.to&&(n.settings.xAxis.range.to=t)}if("column"===n.settings.type){n.settings.largestcolumn=0;for(var e in n.options.lines){var a=n.options.lines[e];n.settings.largestcolumn<a.value&&(n.settings.largestcolumn=a.value)}}if("pie"===n.settings.type&&(n.settings.pie.total=n.options.pie.total||!1,n.settings.pie.total===!1))for(var e in n.options.lines){var a=n.options.lines[e];n.settings.pie.total+=a.value}n.settings.outweWidth=parseInt(getComputedStyle(i).width),n.settings.width=n.settings.outweWidth-n.settings.padding.right-n.settings.padding.left,n.settings.outerHeight=parseInt(getComputedStyle(i).height),n.settings.height=n.settings.outerHeight-n.settings.padding.top-n.settings.padding.bottom,n.settings.rect={top:n.settings.padding.top,left:n.settings.padding.left,right:n.settings.padding.left+n.settings.width,bottom:n.settings.outerHeight-n.settings.padding.bottom}},n.drawLabels=function(){var t,e=[];for(t=0;t<n.settings.yMax+n.settings.yAxis.markEvery;t++)t%n.settings.yAxis.markEvery===0&&e.push(t);for(n.yLabels=n.draw.group().addClass("chartress__labels chartress__labels--yAxis"),n.settings.yPoints=[],t=0;t<e.length;t++)!function(){var s=(1-e[t]/n.settings.yMax*n.settings.height)*-1+n.settings.padding.top,i=14;s-=i/3;var o=e[e.length-1-t];if(0!==o){var a=n.yLabels.text(o.toString()).fill(n.settings.yAxis.label.color).font({family:n.options.graph.fontFamily||"Helvetica",size:i}).dx(n.settings.rect.left+n.settings.yAxis.label.x).dy(s).addClass("chartress__labels__label chartress__labels__label--yAxis");a.dx(parseInt(getComputedStyle(a.node).width)*-1-10),a.dy(parseInt(getComputedStyle(a.node).height)/2*-1),n.settings.yPoints.push(s)}}();var s=(n.settings.longestLine,n.settings.xAxis.range.to-n.settings.xAxis.range.from);for(n.settings.xPoints=[],n.xLabels=n.draw.group().addClass("chartress__labels chartress__labels--xAxis"),t=0;t<=s;t++)!function(){var e=(n.settings.xAxis.range.from+t).toString(),i=t/s,o=n.settings.width*i+n.settings.padding.left;t%n.settings.xAxis.markEvery===0&&n.xLabels.text(e).fill(n.settings.xAxis.label.color).font({family:n.options.graph.fontFamily||"Helvetica",anchor:"middle",size:14}).dx(o).dy(n.settings.rect.bottom+n.settings.xAxis.label.y).addClass("chartress__labels__label chartress__labels--xAxis"),n.settings.xPoints.push(o)}()},n.drawLines=function(){n.draw_plots=n.draw.group().addClass("chartress__plots");for(var t in n.options.lines){var e=n.options.lines[t],s=e.classname||e.name.toLowerCase().replace(/ /g,"_"),i=e.color||"black",o=e.width||2,a=0,l=[];e.__plotgroup=n.draw_plots.group(),e.__plotgroup.addClass("chartress__plot chartress__plot--"+s).attr("plot-name",s);for(var t in e.__plot)!function(){var s=e.__plot[t],i=n.settings.xPoints[a],o=s/n.settings.yMax*n.settings.height;o=n.settings.height-o+n.settings.padding.top,l.push([i,o]),a++}();e.__plotsvg=e.__plotgroup.polyline(l).fill("none").stroke({color:i,width:o}).addClass("chartress__line chartress__line--"+s),e.dash&&e.__plotsvg.attr("stroke-dasharray",e.dash);var r=e.rad||6;for(var t in l)!function(){var n=l[t];e.__plotgroup.circle(r).dx(n[0]-r/2).dy(n[1]-r/2).addClass("chartress__dot chartress__dot--"+s).stroke({color:i,width:o}).fill("white")}()}},n.drawLegend=function(){n.draw_legend=n.draw.group().addClass("chartress__legend").font({family:n.options.graph.fontFamily||"Helvetica",size:13});var t=0,e=n.settings.outweWidth/100*n.settings.legend.x;n.settings.legend.x>50?(e-=n.settings.legend.padding.right,t=n.settings.legend.padding.right*-1):(e+=n.settings.legend.padding.left,t=n.settings.legend.padding.left);var s=0,i=n.settings.outerHeight/100*n.settings.legend.y;n.settings.legend.y<50?(i+=n.settings.legend.padding.top,s=n.settings.legend.padding.top):(i-=n.settings.legend.padding.bottom,s=n.settings.legend.padding.bottom*-1),n.draw_legend.width(n.settings.outweWidth).dmove(e,i);var o=0;for(var a in n.options.lines)!function(){var t=n.options.lines[a];if(t.name){var e=t.classname||t.name.toLowerCase().replace(/ /g,"_"),s=t.color||"black",i=t.width||2;t.__legend=n.draw_legend.group().addClass("chartress__legend__row chartress__legend--"+e).attr("plot-name",e);var l=t.name,r=t.__legend.text(l).fill(s).font({family:n.options.graph.fontFamily||"Helvetica"}),d=(parseInt(getComputedStyle(r.node).width)+40)*-1-5,g=parseInt(getComputedStyle(r.node).height)*o-9;r.dx(d),r.dy(g);var p=t.rad||6,h=parseInt(getComputedStyle(r.node).height)/2,_=parseInt(getComputedStyle(r.node).height)*o+h,c=[[-35,_],[-5,_]],f=t.__legend.polyline(c).fill("none").stroke({color:s,width:i}).addClass("chartress__line chartress__legend__line chartress__legend__line--"+e);t.dash&&f.attr("stroke-dasharray",t.dash),t.__legend.circle(p).stroke({width:i,color:s}).fill("white").dx(0-p/2-5).dy(_-p/2).addClass("chartress__dot chartress__legend__dot--"+e),t.__legend.mouseover(function(){t.__plotgroup.addClass("chartress__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass("chartress__plot--hover")}),o++}}()},n.drawColumns=function(){var t=0;n.draw_columns={labels:n.draw.group().addClass("chartress__columns__labels"),columns:n.draw.group().addClass("chartress__columns__columns")};for(var e in n.options.lines)!function(){var s=n.options.lines[e],i=100/n.options.lines.length/100*t,o=n.settings.width/n.options.lines.length,a=i*n.settings.width+o-o/2,l=n.settings.columns.width||10,r=s.value/n.settings.largestcolumn*n.settings.height,d=n.settings.columns.labels.y||0;n.draw_columns.labels.text(s.name).fill("#000").font({family:n.options.graph.fontFamily||"Helvetica",anchor:"middle",size:n.settings.columns.labels.fontsize||14}).dx(a+n.settings.padding.left).dy(n.settings.height+d+n.settings.padding.top).addClass("chartress__columns__label"),n.draw_columns.columns.rect(l,r).dx(a-l/2+n.settings.padding.left).dy(n.settings.height-r+n.settings.padding.top).addClass("chartress__columns__column"),t++}()},n.drawPies=function(){var t=0;n.pies={},n.draw_pie=n.draw.group().addClass("chartress__pies");var e,s=n.settings.width<n.settings.height?n.settings.width:n.settings.height,i=n.settings.width/2-s/2+n.settings.rect.left,o=n.settings.height/2-s/2+n.settings.rect.top;for(var a in n.options.lines)!function(){var l=n.options.lines[a],r=l.classname||"noclass-"+t,d=s;"undefined"!=typeof l.width&&(d=l.width),n.pies[r]={},n.pies[r].el=n.draw_pie.circle(s),n.pies[r].el.attr("stroke-dasharray","20,10").fill("transparent").addClass("chartress__pie").dx(i).dy(o).stroke({width:d,color:l.color||"#aaa"}).rotate(-90);var g=2*Math.PI*(s/2);n.pies[r].el.attr("stroke-dasharray","0,"+g),l.mask!==!1&&(e=n.draw_pie.circle(s).fill({color:"white"}).dx(i).dy(o),n.pies[r].el.maskWith(e)),n.pies[r].set=function(t){var e=t*g/100;n.pies[r].el.attr("stroke-dasharray",e+","+g)},setTimeout(function(){n.pies[r].set(l.value),n.pies[r].el.addClass("chartress__pie--"+r)}),t++}();var l=n.settings.pie.title||!1;if(l.text!==!1){n.draw_pie_title=n.draw_pie.group().addClass("chartress__pie__title");var r=n.draw_pie_title.text(l.text).addClass("chartress__pie__title--main").font({family:n.options.graph.fontFamily||"Helvetica",size:l.size,anchor:"middle"}).dx(n.settings.width/2+n.settings.padding.left).dy(n.settings.height/2+n.settings.padding.top);l.bold&&r.font({family:n.options.graph.fontFamily||"Helvetica",weight:"bold"}),r.dy(parseInt(getComputedStyle(r.node).height)*-.9);var d=l.pre||!1;d&&(pretext=n.draw_pie_title.text(d.text).addClass("chartress__pie__title--pre").font({family:n.options.graph.fontFamily||"Helvetica",size:d.size,anchor:"middle"}).dx(n.settings.width/2+n.settings.padding.top).dy(n.settings.height/2+n.settings.padding.left-parseInt(getComputedStyle(r.node).height)/2),pretext.dy(parseInt(getComputedStyle(r.node).height)*-1.8));var g=l.sub||!1;g&&(subText=n.draw_pie_title.text(g.text).addClass("chartress__pie__title--sub").font({family:n.options.graph.fontFamily||"Helvetica",size:g.size,anchor:"middle"}).dx(n.settings.width/2+n.settings.padding.left).dy(n.settings.height/2+.11*n.settings.height+n.settings.padding.top))}},n.drawGraph=function(){n.clear(),n.setBounds(),"normal"===n.settings.type&&(n.drawLabels(),n.drawLines(),n.drawLegend()),"column"===n.settings.type&&n.drawColumns(),"pie"===n.settings.type&&n.drawPies()},n.canvasResize=function(){n.draw.spof(),n.drawGraph()};var a,l=[parseInt(getComputedStyle(i).width),parseInt(getComputedStyle(i).height)];return SVG.on(window,"resize",function(){l[0]===parseInt(getComputedStyle(i).width)&&l[1]===parseInt(getComputedStyle(i).height)||(clearTimeout(a),a=setTimeout(n.canvasResize,n.options.graph.redrawTimeout||0))}),n.drawGraph(),n};