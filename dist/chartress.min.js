window.chartress=function(t,s){function e(t,s){return s-t}var i=t;"undefined"!=typeof jQuery&&t instanceof jQuery&&(i=i[0]);var a={};a.settings={yMax:0},a.options=s,a.draw=SVG(i).size("100%","100%").spof(),a.clear=function(){a.draw.clear()},"undefined"==typeof a.options.graph&&(a.options.graph={}),"undefined"==typeof a.options.graph.padding&&(a.options.graph.padding=[]),a.settings.padding={top:a.options.graph.padding[0]||0,right:a.options.graph.padding[1]||0,bottom:a.options.graph.padding[2]||0,left:a.options.graph.padding[3]||0},a.settings.type=a.options.type||"normal",a.setBounds=function(){if("normal"===a.settings.type)for(var t in a.options.lines){var s=a.options.lines[t],n=s.plot.slice(0);n.length>a.options.xAxis.maxRangeLength&&(n.reverse(),n.length=a.options.xAxis.maxRangeLength,n.reverse()),s.__plot=n.slice(0),n.sort(e),a.settings.yMax<n[0]&&(a.settings.yMax=n[0])}if("pipes"===a.settings.type){a.settings.largestPipe=0;for(var t in a.options.lines){var s=a.options.lines[t];a.settings.largestPipe<s.value&&(a.settings.largestPipe=s.value)}}if("pie"===a.settings.type&&(a.settings.pie={},a.settings.pie.total=a.options.pie.total||!1,a.settings.pie.total===!1))for(var t in a.options.lines){var s=a.options.lines[t];a.settings.pie.total+=s.value}a.settings.outweWidth=i.scrollWidth,a.settings.width=i.scrollWidth-a.settings.padding.right-a.settings.padding.left,a.settings.outerHeight=i.scrollHeight,a.settings.height=i.scrollHeight-a.settings.padding.top-a.settings.padding.bottom,a.settings.rect={top:a.settings.padding.top,left:a.settings.padding.left,right:a.settings.padding.left+a.settings.width,bottom:a.settings.outerHeight-a.settings.padding.bottom}},a.drawLabels=function(){var t,s=0;for(t=0;t<a.settings.yMax+a.options.yAxis.markEvery;t++)t%a.options.yAxis.markEvery===0&&s++;for(a.yLabels=a.draw.group().addClass("chartress__labels chartress__labels--yAxis"),a.settings.yPoints=[],t=0;t<s;t++)!function(){var e=1-(t+1)/s,i=(a.settings.height+.146*a.settings.height)*e+a.settings.padding.top,n=t*a.options.yAxis.markEvery;if(0!==n){var o=a.yLabels.text(n.toString()).fill(a.options.yAxis.label.color).font({family:a.options.graph.fontFamily||"Helvetica",anchor:"middle",size:14}).dx(a.settings.rect.left+a.options.yAxis.label.x).dy(i).addClass("chartress__labels__label chartress__labels__label--yAxis");o.dy(o.node.scrollHeight/2*-1),a.settings.yPoints.push(i)}}();var e=(a.settings.longestLine,a.options.xAxis.range.to-a.options.xAxis.range.from);for(a.settings.xPoints=[],a.xLabels=a.draw.group().addClass("chartress__labels chartress__labels--xAxis"),t=0;t<=e;t++)!function(){var s=a.options.xAxis.range.from+t;s<10&&(s="0"+s);var i=s+":00",n=t/e,o=a.settings.width*n+a.settings.padding.left;t%a.options.xAxis.markEvery===0&&a.xLabels.text(i).fill(a.options.xAxis.label.color).font({family:a.options.graph.fontFamily||"Helvetica",anchor:"middle",size:14}).dx(o).dy(a.settings.rect.bottom+a.options.xAxis.label.y).addClass("chartress__labels__label chartress__labels--xAxis"),a.settings.xPoints.push(o)}()},a.drawLines=function(){a.draw_plots=a.draw.group().addClass("chartress__plots");for(var t in a.options.lines){var s=a.options.lines[t],e=0,i=[];s.__plotgroup=a.draw_plots.group(),s.__plotgroup.addClass("chartress__plot chartress__plot--"+s.classname).attr("plot-name",s.classname);for(var t in s.__plot)!function(){var n=s.__plot[t],o=a.settings.xPoints[e],r=a.settings.height-n/a.settings.yMax*a.settings.height+a.settings.padding.top;i.push([o,r]),e++}();s.__plotsvg=s.__plotgroup.polyline(i).fill("none").stroke({width:2}).addClass("chartress__line chartress__line--"+s.classname),s.dash&&s.__plotsvg.attr("stroke-dasharray",s.dash);var n=s.rad;for(var t in i)!function(){var e=i[t];s.__plotgroup.circle(n).dx(e[0]-n/2).dy(e[1]-n/2).addClass("chartress__dot chartress__dot--"+s.classname)}()}},a.drawLegend=function(){a.draw_legend=a.draw.group().addClass("chartress__legend").font({family:a.options.graph.fontFamily||"Helvetica",size:13});var t=0,s=a.settings.outweWidth/100*a.options.legend.x;a.options.legend.x>50?(s-=a.options.legend.padding[1],t=a.options.legend.padding[1]*-1):(s+=a.options.legend.padding[3],t=a.options.legend.padding[3]);var e=0,i=a.settings.outerHeight/100*a.options.legend.y;a.options.legend.y<50?(i+=a.options.legend.padding[0],e=a.options.legend.padding[0]):(i-=a.options.legend.padding[2],e=a.options.legend.padding[2]*-1),a.draw_legend.width(a.settings.outweWidth).dmove(s,i);var n=0;for(var o in a.options.lines)!function(){var t=a.options.lines[o];t.__legend=a.draw_legend.group().addClass("chartress__legend__row chartress__legend--"+t.classname).attr("plot-name",t.classname);var s=t.name,i=t.__legend.text(s).font({family:a.options.graph.fontFamily||"Helvetica"}),r=(i.node.scrollWidth+40)*-1,l=i.node.scrollHeight*n*1.1;i.dx(r),i.dy(l);var d=t.rad,p=1.1*i.node.scrollHeight*.2,g=[[-30,e+(i.node.scrollHeight-p)+l],[0,e+(i.node.scrollHeight-p)+l]],h=t.__legend.polyline(g).fill("none").stroke({width:2}).addClass("chartress__line chartress__legend__line chartress__legend__line--"+t.classname);t.dash&&h.attr("stroke-dasharray",t.dash),t.__legend.circle(d).dx(0-d/2).dy(e+(i.node.scrollHeight-p)+l-d/2).addClass("chartress__dot chartress__legend__dot--"+t.classname),t.__legend.mouseover(function(){t.__plotgroup.addClass("chartress__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass("chartress__plot--hover")}),n++}()},a.drawPipes=function(){var t=0;a.draw_pipes={labels:a.draw.group().addClass("chartress__pipes__labels"),pipes:a.draw.group().addClass("chartress__pipes__pipes")};for(var s in a.options.lines)!function(){var e=a.options.lines[s],i=100/a.options.lines.length/100*t,n=a.settings.width/a.options.lines.length,o=i*a.settings.width+n-n/2,r=a.options.pipes.width||10,l=e.value/a.settings.largestPipe*a.settings.height,d=a.options.pipes.labels.y||0;a.draw_pipes.labels.text(e.name).fill("#000").font({family:a.options.graph.fontFamily||"Helvetica",anchor:"middle",size:a.options.pipes.labels.fontsize||14}).dx(o+a.settings.padding.left).dy(a.settings.height+d+a.settings.padding.top).addClass("chartress__pipes__label"),a.draw_pipes.pipes.rect(r,l).dx(o-r/2+a.settings.padding.left).dy(a.settings.height-l+a.settings.padding.top).addClass("chartress__pipes__pipe"),t++}()},a.drawPies=function(){var t=0;a.pies={},a.draw_pie=a.draw.group().addClass("chartress__pies");var s,e=a.settings.width<a.settings.height?a.settings.width:a.settings.height,i=a.settings.width/2-e/2+a.settings.rect.left,n=a.settings.height/2-e/2+a.settings.rect.top;for(var o in a.options.lines)!function(){var r=a.options.lines[o],l=e;"undefined"!=typeof r.width&&(l=r.width),a.pies[r.classname]={},a.pies[r.classname].el=a.draw_pie.circle(e),a.pies[r.classname].el.attr("stroke-dasharray","20,10").fill("transparent").addClass("chartress__pie").dx(i).dy(n).stroke({width:l,color:"#000"}).rotate(-90);var d=2*Math.PI*(e/2);a.pies[r.classname].el.attr("stroke-dasharray","0,"+d),r.mask!==!1&&(s=a.draw_pie.circle(e).fill({color:"white"}).dx(i).dy(n),a.pies[r.classname].el.maskWith(s)),a.pies[r.classname].set=function(t){var s=t*d/100;a.pies[r.classname].el.attr("stroke-dasharray",s+","+d)},setTimeout(function(){a.pies[r.classname].set(r.value),a.pies[r.classname].el.addClass("chartress__pie--"+r.classname)}),t++}();var r=a.options.pie.title||!1;if(r){a.draw_pie_title=a.draw_pie.group().addClass("chartress__pie__title");var l=a.draw_pie_title.text(r.text).addClass("chartress__pie__title--main").font({family:a.options.graph.fontFamily||"Helvetica",size:r.size,anchor:"middle"}).dx(a.settings.width/2).dy(a.settings.outerHeight/2);r.bold&&l.font({family:a.options.graph.fontFamily||"Helvetica",weight:"bold"}),l.dy(l.node.scrollHeight*-.9);var d=r.pre||!1;d&&(pretext=a.draw_pie_title.text(d.text).addClass("chartress__pie__title--pre").font({family:a.options.graph.fontFamily||"Helvetica",size:d.size,anchor:"middle"}).dx(a.settings.width/2).dy(a.settings.height/2-l.node.scrollHeight/2),pretext.dy(pretext.node.scrollHeight*-1.8));var p=r.sub||!1;p&&(subText=a.draw_pie_title.text(p.text).addClass("chartress__pie__title--sub").font({family:a.options.graph.fontFamily||"Helvetica",size:p.size,anchor:"middle"}).dx(a.settings.width/2).dy(a.settings.height/2+.11*a.settings.height))}},a.drawGraph=function(){a.clear(),a.setBounds(),"normal"===a.settings.type&&(a.drawLabels(),a.drawLines(),a.drawLegend()),"pipes"===a.settings.type&&a.drawPipes(),"pie"===a.settings.type&&a.drawPies()},a.canvasResize=function(){a.draw.spof(),a.drawGraph()};var n,o=[i.scrollWidth,i.scrollHeight];return SVG.on(window,"resize",function(){o[0]===i.scrollWidth&&o[1]===i.scrollHeight||(clearTimeout(n),n=setTimeout(a.canvasResize,a.options.graph.redrawTimeout||100))}),a.drawGraph(),a};