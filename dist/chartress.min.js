window.chartress=function(t,s){function e(t,s){return s-t}var i={},n=t;"undefined"!=typeof jQuery&&t instanceof jQuery&&(n=n[0]),i.options=s,i.draw=SVG(n).size("100%","100%").spof(),i.clear=function(){i.draw.clear()},i.options.debug===!0&&(console.info("chartress debug enabled for "),console.info(n),console.info("Passed Data: "),console.info(i.options),console.log("------")),"undefined"==typeof i.options.graph&&(i.options.graph={}),"undefined"==typeof i.options.xAxis&&(i.options.xAxis={}),"undefined"==typeof i.options.xAxis.range&&(i.options.xAxis.range={}),"undefined"==typeof i.options.xAxis.legend&&(i.options.xAxis.legend={}),"undefined"==typeof i.options.yAxis&&(i.options.yAxis={}),"undefined"==typeof i.options.yAxis.label&&(i.options.yAxis.label={}),"undefined"==typeof i.options.legend&&(i.options.legend={}),"undefined"==typeof i.options.xAxis.label&&(i.options.xAxis.label={}),"undefined"==typeof i.options.xAxis.label.format&&(i.options.xAxis.label.format=function(t){return t}),"undefined"==typeof i.options.legend.padding&&(i.options.legend.padding={}),"undefined"==typeof i.options.graph.padding&&(i.options.graph.padding={}),"undefined"==typeof i.options.columns&&(i.options.columns={}),"undefined"==typeof i.options.columns.labels&&(i.options.columns.labels={}),"undefined"==typeof i.options.pie&&(i.options.pie={}),"undefined"==typeof i.options.pie.title&&(i.options.pie.title={}),i.log=function(t){i.options.debug===!0&&console.log(t)};var o=function(t){return getComputedStyle(t)},a=i.options.xAxis.maxRangeLength||1/0;i.settings={yMax:0,fontSize:i.options.graph.fontFamily||"Helvetica","class":i.options.graph.class_prefix||"chartress",padding:{top:i.options.graph.padding.top||0,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||0,left:i.options.graph.padding.left||0},type:i.options.type||"line",yAxis:{markEvery:i.options.yAxis.markEvery||1,label:{color:i.options.yAxis.label.color||"gray",x:i.options.yAxis.label.x||0},markEvery:i.options.yAxis.markEvery||20},xAxis:{range:{from:i.options.xAxis.range.from||0,to:i.options.xAxis.range.to||null},markEvery:i.options.xAxis.markEvery||1,label:{color:i.options.xAxis.label.color||"gray",y:i.options.xAxis.label.y||0}},legend:{x:i.options.legend.x||100,y:i.options.legend.x||0,padding:{top:i.options.legend.padding.top||0,right:i.options.legend.padding.right||0,bottom:i.options.legend.padding.bottom||0,left:i.options.legend.padding.left||0}},columns:{width:i.options.columns.width||15,labels:{fontSize:i.options.columns.labels.fontSize||16,y:i.options.columns.labels.y||1}},pie:{total:i.options.pie.total||100,red:"blue",title:{size:i.options.pie.title.size||50,bold:i.options.pie.title.bold||!0,text:i.options.pie.title.text||!1,pre:i.options.pie.title.pre||!1,sub:i.options.pie.title.sub||!1}}},"line"===i.settings.type&&(i.settings.padding={top:i.options.graph.padding.top||10,right:i.options.graph.padding.right||8,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35}),"column"===i.settings.type&&(i.settings.padding={top:i.options.graph.padding.top||0,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||0}),i.setBounds=function(){if("line"===i.settings.type){var t=0;for(var s in i.options.dataset)!function(){var n=i.options.dataset[s],o=n.plot.slice(0);o.length>a&&(o.reverse(),o.length=a,o.reverse()),o.length>t&&(t=o.length-1),n.__plot=o.slice(0),o.sort(e),i.settings.yMax<o[0]&&(i.settings.yMax=o[0])}();a=t,null===i.settings.xAxis.range.to&&(i.settings.xAxis.range.to=t)}if("column"===i.settings.type){i.settings.largestcolumn=0;for(var s in i.options.dataset){var l=i.options.dataset[s];i.settings.largestcolumn<l.value&&(i.settings.largestcolumn=l.value)}}if("pie"===i.settings.type&&(i.settings.pie.total=i.options.pie.total||!1,i.settings.pie.total===!1))for(var s in i.options.dataset){var l=i.options.dataset[s];i.settings.pie.total+=l.value}i.settings.outerWidth=parseInt(o(n).width),i.settings.width=i.settings.outerWidth-i.settings.padding.right-i.settings.padding.left,i.settings.outerHeight=parseInt(o(n).height),i.settings.height=i.settings.outerHeight-i.settings.padding.top-i.settings.padding.bottom,i.settings.rect={top:i.settings.padding.top,left:i.settings.padding.left,right:i.settings.padding.left+i.settings.width,bottom:i.settings.outerHeight-i.settings.padding.bottom}},i.drawLabels=function(){var t,s=[];for(t=0;t<i.settings.yMax+i.settings.yAxis.markEvery;t++)t%i.settings.yAxis.markEvery===0&&s.push(t);for(i.yLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--yAxis"),i.settings.yPoints=[],t=0;t<s.length;t++)!function(){var e=(1-s[t]/i.settings.yMax*i.settings.height)*-1+i.settings.padding.top,n=14;e-=n/3;var a=s[s.length-1-t];if(0!==a){var l=i.yLabels.text(a.toString()).fill(i.settings.yAxis.label.color).font({family:i.settings.fontFamily,size:n}).dx(i.settings.rect.left+i.settings.yAxis.label.x).dy(e).addClass(i.settings["class"]+"__labels__label chartress__labels__label--yAxis");l.dx(parseInt(o(l.node).width)*-1-10),l.dy(parseInt(o(l.node).height)/2*-1),i.settings.yPoints.push(e)}}();var e=(i.settings.longestLine,a);for(i.settings.xPoints=[],i.xLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--xAxis"),t=0;t<=e;t++)!function(){var s=i.settings.xAxis.range.from+t;s=i.options.xAxis.label.format(s),s=s.toString();var n=t/e,o=i.settings.width*n+i.settings.padding.left;t%i.settings.xAxis.markEvery===0&&i.xLabels.text(s).fill(i.settings.xAxis.label.color).font({family:i.settings.fontFamily,anchor:"middle",size:14}).dx(o).dy(i.settings.rect.bottom+i.settings.xAxis.label.y).addClass(i.settings["class"]+"__labels__label chartress__labels--xAxis"),i.settings.xPoints.push(o)}()},i.drawLines=function(){i.draw_plots=i.draw.group().addClass(i.settings["class"]+"__plots");for(var t in i.options.dataset){var s=i.options.dataset[t],e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),n=s.color||"black",o=s.width||2,l=[];s.__plotgroup=i.draw_plots.group(),s.__plotgroup.addClass(i.settings["class"]+"__plot chartress__plot--"+e).attr("plot-name",e);var d=0;for(var t in s.__plot)!function(){var e=s.__plot[t],n=d/a*i.settings.width+i.settings.padding.left,o=e/i.settings.yMax*i.settings.height;o=i.settings.height-o+i.settings.padding.top,l.push([n,o]),d++}();s.__plotsvg=s.__plotgroup.polyline(l).fill("none").stroke({color:n,width:o}).addClass(i.settings["class"]+"__line chartress__line--"+e),s.dash&&s.__plotsvg.attr("stroke-dasharray",s.dash);var g=s.rad||6;for(var t in l)!function(){var a=l[t];s.__plotgroup.circle(g).dx(a[0]-g/2).dy(a[1]-g/2).addClass(i.settings["class"]+"__dot chartress__dot--"+e).stroke({color:n,width:o}).fill("white")}()}},i.drawLegend=function(){i.draw_legend=i.draw.group().addClass(i.settings["class"]+"__legend").font({family:i.settings.fontFamily,size:12});var t=0,s=i.settings.outerWidth/100*i.settings.legend.x;i.settings.legend.x>50?(s-=i.settings.legend.padding.right,t=i.settings.legend.padding.right*-1):(s+=i.settings.legend.padding.left,t=i.settings.legend.padding.left);var e=0,n=i.settings.outerHeight/100*i.settings.legend.y;i.settings.legend.y<50?(n+=i.settings.legend.padding.top,e=i.settings.legend.padding.top):(n-=i.settings.legend.padding.bottom,e=i.settings.legend.padding.bottom*-1),i.draw_legend.width(i.settings.outerWidth).dmove(s,n);var a=0;for(var l in i.options.dataset)!function(){var t=i.options.dataset[l];if(t.name){var s=t.classname||t.name.toLowerCase().replace(/ /g,"_"),e=t.color||"black",n=t.width||2;t.__legend=i.draw_legend.group().addClass(i.settings["class"]+"__legend__row chartress__legend--"+s).attr("plot-name",s);var d=t.name,g=t.__legend.text(d).fill(e).font({family:i.settings.fontFamily}),r=(parseInt(o(g.node).width)+40)*-1-5,p=parseInt(o(g.node).height)*a-9;g.dx(r),g.dy(p);var c=t.rad||6,f=parseInt(o(g.node).height)/2+1,_=parseInt(o(g.node).height)*a+f,h=[[-35,_],[-5,_]],u=t.__legend.polyline(h).fill("none").stroke({color:e,width:n}).addClass(i.settings["class"]+"__line chartress__legend__line chartress__legend__line--"+s);t.dash&&u.attr("stroke-dasharray",t.dash),t.__legend.circle(c).stroke({width:n,color:e}).fill("white").dx(0-c/2-5).dy(_-c/2).addClass(i.settings["class"]+"__dot chartress__legend__dot--"+s),t.__legend.mouseover(function(){t.__plotgroup.addClass(i.settings["class"]+"__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass(i.settings["class"]+"__plot--hover")}),a++}}()},i.drawColumns=function(){i.draw_columns=[];var t=0;for(var s in i.options.dataset)!function(){var e=i.options.dataset[s],n=e.name||(t+1).toString(),o=e.classname||n.replace(/ /g,"_").toLowerCase();i.draw_columns[t]=i.draw.group().addClass(i.settings["class"]+"__columns__group "+i.settings["class"]+"__columns__group--"+o);var a=e.color||"#222",l=e.textColor||a,d=100/i.options.dataset.length/100*t,g=i.settings.width/i.options.dataset.length,r=d*i.settings.width+g-g/2,p=i.settings.columns.width,c=e.value/i.settings.largestcolumn*i.settings.height,f=i.settings.columns.labels.y;i.draw_columns[t].text(n).fill(l).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.columns.labels.fontsize}).dx(r+i.settings.padding.left).dy(i.settings.height+f+i.settings.padding.top).addClass(i.settings["class"]+"__columns__label "+i.settings["class"]+"__columns__label--"+o),i.draw_columns[t].rect(p,c).dx(r-p/2+i.settings.padding.left).dy(i.settings.height-c+i.settings.padding.top).fill(a).addClass(i.settings["class"]+"__columns__column "+i.settings["class"]+"__columns__column--"+o),t++}()},i.drawPies=function(){var t=0;i.pies={},i.draw_pie=i.draw.group().addClass(i.settings["class"]+"__pies");var s=i.settings.width<i.settings.height?i.settings.width:i.settings.height,e=i.settings.width/2-s/2+i.settings.rect.left,n=i.settings.height/2-s/2+i.settings.rect.top,o=i.options.pie.total||"count",a=0;if("count"===o){o=0;for(var l in i.options.lines){var d=i.options.lines[l];o+=d.value}}var g;for(var l in i.options.lines)!function(){var d=i.options.lines[l],r=0,p=-90+r;"number"==typeof d.position?(d.position>1&&(d.position=d.position/100),r=360*d.position):0!==a&&(r=a/o*360),"number"!=typeof d.position&&(a+=d.value),p=-90+r;var c=d.classname||"noclass-"+t,f=s;"undefined"!=typeof d.width&&(f=d.width),i.pies[c]={},i.pies[c].el=i.draw_pie.circle(s),i.pies[c].el.attr("stroke-dasharray","20,10").fill("transparent").addClass(i.settings["class"]+"__pie").dx(e).dy(n).stroke({width:f,color:d.color||"#aaa"});var _=2*Math.PI*(s/2);i.pies[c].el.attr("stroke-dasharray","0,"+_),i.pies[c].el.rotate(p),d.mask!==!1&&(g=i.draw_pie.circle(s).fill({color:"white"}).dx(e).dy(n),i.pies[c].el.maskWith(g)),i.pies[c].set=function(t){var s=t*_/o;i.pies[c].el.attr("stroke-dasharray",s+","+_)},setTimeout(function(){i.pies[c].set(d.value),i.pies[c].el.addClass(i.settings["class"]+"__pie--"+c)}),t++}();var r=i.settings.pie.title||!1;if(r.text!==!1){i.draw_pie_title=i.draw_pie.group().addClass(i.settings["class"]+"__pie__title");var p=i.draw_pie_title.text(r.text).addClass(i.settings["class"]+"__pie__title--main").font({family:i.settings.fontFamily,size:r.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2+i.settings.padding.top-.9*r.size);r.bold&&p.font({family:i.settings.fontFamily,weight:"bold"});var c=r.pre||!1;c&&(pretext=i.draw_pie_title.text(c.text).addClass(i.settings["class"]+"__pie__title--pre").font({family:i.settings.fontFamily,size:c.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2-r.size/2-c.size-5+i.settings.padding.top));var f=r.sub||!1;f&&(subText=i.draw_pie_title.text(f.text).addClass(i.settings["class"]+"__pie__title--sub").font({family:i.settings.fontFamily,size:f.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2+r.size/2.5+i.settings.padding.top))}},i.drawChart=function(){i.clear(),i.setBounds(),"line"===i.settings.type&&(i.drawLabels(),i.drawLines(),i.drawLegend()),"column"===i.settings.type&&i.drawColumns(),"pie"===i.settings.type&&i.drawPies(),setTimeout(function(){i.draw.spof()})},i.canvasResize=function(){i.draw.spof(),i.drawChart()};var l,d=[parseInt(o(n).width),parseInt(o(n).height)];return SVG.on(window,"resize",function(){d[0]===parseInt(o(n).width)&&d[1]===parseInt(o(n).height)||(clearTimeout(l),l=setTimeout(i.canvasResize,i.options.graph.redrawTimeout||0))}),i.drawToCanvas=function(s){var e=t.querySelector("svg"),n=s.getContext("2d");n.canvas.width=i.settings.outerWidth,n.canvas.height=i.settings.outerHeight;var o=new Image,a=(new XMLSerializer).serializeToString(e),l=btoa(a),d="data:image/svg+xml;base64,",g=d+l;o.src=g,n.drawImage(o,0,0)},i.drawChart(),i};