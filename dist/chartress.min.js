window.chartress=function(t,s){function e(t,s){return s-t}var i={},n=t;"undefined"!=typeof jQuery&&t instanceof jQuery&&(n=n[0]),i.options=s,i.draw=SVG(n).size("100%","100%").spof(),i.clear=function(){i.draw.clear()},i.options.debug===!0&&(console.info("chartress debug enabled for "),console.info(n),console.info("Passed Data: "),console.info(i.options),console.log("------")),"undefined"==typeof i.options.graph&&(i.options.graph={}),"undefined"==typeof i.options.xAxis&&(i.options.xAxis={}),"undefined"==typeof i.options.xAxis.range&&(i.options.xAxis.range={}),"undefined"==typeof i.options.xAxis.legend&&(i.options.xAxis.legend={}),"undefined"==typeof i.options.yAxis&&(i.options.yAxis={}),"undefined"==typeof i.options.yAxis.label&&(i.options.yAxis.label={}),"undefined"==typeof i.options.legend&&(i.options.legend={}),"undefined"==typeof i.options.yAxis.label.format&&(i.options.yAxis.label.format=function(t){return t}),"undefined"==typeof i.options.xAxis.label&&(i.options.xAxis.label={}),"undefined"==typeof i.options.xAxis.label.format&&(i.options.xAxis.label.format=function(t){return t}),"undefined"==typeof i.options.legend.padding&&(i.options.legend.padding={}),"undefined"==typeof i.options.graph.padding&&(i.options.graph.padding={}),"undefined"==typeof i.options.columns&&(i.options.columns={}),"undefined"==typeof i.options.columns.labels&&(i.options.columns.labels={}),"undefined"==typeof i.options.pie&&(i.options.pie={}),"undefined"==typeof i.options.pie.title&&(i.options.pie.title={}),i.log=function(t){i.options.debug===!0&&console.log(t)};var o=function(t){return getComputedStyle(t)},a=i.options.xAxis.maxRangeLength||null;i.settings={yMax:0,fontSize:i.options.graph.fontFamily||"Helvetica","class":i.options.graph.class_prefix||"chartress",padding:{top:i.options.graph.padding.top||0,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||0,left:i.options.graph.padding.left||0},type:i.options.type||"line",yAxis:{markEvery:i.options.yAxis.markEvery||1,label:{color:i.options.yAxis.label.color||"gray",x:i.options.yAxis.label.x||0},markEvery:i.options.yAxis.markEvery||20},xAxis:{range:{from:i.options.xAxis.range.from||0,to:i.options.xAxis.range.to||null},markEvery:i.options.xAxis.markEvery||1,label:{color:i.options.xAxis.label.color||"gray",y:i.options.xAxis.label.y||0,pos:i.options.xAxis.label.position||"bottom",size:i.options.xAxis.label.size||14}},legend:{x:i.options.legend.x||100,y:i.options.legend.x||0,padding:{top:i.options.legend.padding.top||0,right:i.options.legend.padding.right||0,bottom:i.options.legend.padding.bottom||0,left:i.options.legend.padding.left||0}},columns:{width:i.options.columns.width||40,space:i.options.columns.space||4,labels:{fontSize:i.options.columns.labels.fontSize||16,y:i.options.columns.labels.y||1}},pie:{total:i.options.pie.total||100,red:"blue",title:{size:i.options.pie.title.size||50,bold:i.options.pie.title.bold||!0,text:i.options.pie.title.text||!1,pre:i.options.pie.title.pre||!1,sub:i.options.pie.title.sub||!1}}},"line"===i.settings.type&&(i.settings.padding={top:i.options.graph.padding.top||10,right:i.options.graph.padding.right||8,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35}),"column"===i.settings.type&&(i.settings.padding={top:i.options.graph.padding.top||25,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35},i.settings.xAxis.label.pos=i.options.xAxis.label.position||"top",i.settings.xAxis.label.y=i.options.xAxis.label.y||-5),i.setBounds=function(){if("line"===i.settings.type||"column"==i.settings.type){var t=0;for(var s in i.options.dataset)!function(){var n=i.options.dataset[s],o=n.plot.slice(0);null!==a&&o.length>a&&(o.reverse(),o.length=a,o.reverse()),o.length>t&&(t=o.length-1),n.__plot=o.slice(0),o.sort(e),i.settings.yMax<o[0]&&(i.settings.yMax=o[0])}();a=t,null===i.settings.xAxis.range.to&&(i.settings.xAxis.range.to=t)}if("column"===i.settings.type){i.settings.largestcolumn=0;for(var s in i.options.dataset)for(var l=i.options.dataset[s],d=0;d<l.__plot.length;d++){var g=l.__plot[d];i.settings.largestcolumn<g&&(i.settings.largestcolumn=g)}}if("pie"===i.settings.type&&(i.settings.pie.total=i.options.pie.total||!1,i.settings.pie.total===!1))for(var s in i.options.dataset){var l=i.options.dataset[s];i.settings.pie.total+=l.value}i.settings.outerWidth=parseInt(o(n).width),i.settings.width=i.settings.outerWidth-i.settings.padding.right-i.settings.padding.left,i.settings.outerHeight=parseInt(o(n).height),i.settings.height=i.settings.outerHeight-i.settings.padding.top-i.settings.padding.bottom,i.settings.rect={top:i.settings.padding.top,left:i.settings.padding.left,right:i.settings.padding.left+i.settings.width,bottom:i.settings.outerHeight-i.settings.padding.bottom},i.options.debug===!0&&i.draw.rect(i.settings.width,i.settings.height).fill("#eee").dx(i.settings.rect.left).dy(i.settings.rect.top)},i.drawLabels=function(){var t,s=[];for(t=0;t<i.settings.yMax+i.settings.yAxis.markEvery;t++)t%i.settings.yAxis.markEvery===0&&s.push(t);for(i.yLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--yAxis"),i.settings.yPoints=[],t=0;t<s.length;t++)!function(){var e=(1-s[t]/i.settings.yMax*i.settings.height)*-1+i.settings.padding.top,n=14;e-=n/3;var a=s[s.length-1-t];a=i.options.yAxis.label.format(a),a=a.toString();var l=i.yLabels.text(a).fill(i.settings.yAxis.label.color).font({family:i.settings.fontFamily,size:n}).dx(i.settings.rect.left+i.settings.yAxis.label.x).dy(e).addClass(i.settings["class"]+"__labels__label chartress__labels__label--yAxis");l.dx(parseInt(o(l.node).width)*-1-10),l.dy(parseInt(o(l.node).height)/2*-1),i.settings.yPoints.push(e)}();var e=(i.settings.longestLine,i.settings.xAxis.range.to-i.settings.xAxis.range.from);null!==a&&(e=a),i.settings.xPoints=[];var n=0;if("column"===i.settings.type&&(e++,n=i.settings.width/e/2),i.options.xAxis.visible!==!1){var l=0;for(i.options.xAxis.maxRangeLength&&(l=i.options.xAxis.maxRangeLength+1),i.log([l,e]),i.xLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--xAxis"),t=0;t<=e;t++)!function(){var s=i.settings.xAxis.range.from+t+l;s=i.options.xAxis.label.format(s),s=s.toString();var o=t/e,a=i.settings.width*o+i.settings.padding.left,d=i.settings.rect.bottom+i.settings.xAxis.label.y;"top"===i.settings.xAxis.label.pos&&(d=i.settings.rect.top-1.5*i.settings.xAxis.label.size+i.settings.xAxis.label.y),t%i.settings.xAxis.markEvery===0&&i.xLabels.text(s).fill(i.settings.xAxis.label.color).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.xAxis.label.size}).dx(a+n).dy(d).addClass(i.settings["class"]+"__labels__label chartress__labels--xAxis"),i.settings.xPoints.push(a)}()}},i.drawLines=function(){i.draw_plots=i.draw.group().addClass(i.settings["class"]+"__plots");for(var t in i.options.dataset){var s=i.options.dataset[t],e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),n=s.color||"black",o=s.width||2,l=[];s.__plotgroup=i.draw_plots.group(),s.__plotgroup.addClass(i.settings["class"]+"__plot chartress__plot--"+e).attr("plot-name",e);var d=0;for(var t in s.__plot)!function(){var e=s.__plot[t],n=d/a*i.settings.width+i.settings.padding.left,o=e/i.settings.yMax*i.settings.height;o=i.settings.height-o+i.settings.padding.top,l.push([n,o]),d++}();s.__plotsvg=s.__plotgroup.polyline(l).fill("none").stroke({color:n,width:o}).addClass(i.settings["class"]+"__line chartress__line--"+e),s.dash&&s.__plotsvg.attr("stroke-dasharray",s.dash);var g=s.rad||6;for(var t in l)!function(){var a=l[t];s.__plotgroup.circle(g).dx(a[0]-g/2).dy(a[1]-g/2).addClass(i.settings["class"]+"__dot chartress__dot--"+e).stroke({color:n,width:o}).fill("white")}()}},i.drawLegend=function(){i.draw_legend=i.draw.group().addClass(i.settings["class"]+"__legend").font({family:i.settings.fontFamily,size:12});var t=0,s=i.settings.outerWidth/100*i.settings.legend.x;i.settings.legend.x>50?(s-=i.settings.legend.padding.right,t=i.settings.legend.padding.right*-1):(s+=i.settings.legend.padding.left,t=i.settings.legend.padding.left);var e=0,n=i.settings.outerHeight/100*i.settings.legend.y;i.settings.legend.y<50?(n+=i.settings.legend.padding.top,e=i.settings.legend.padding.top):(n-=i.settings.legend.padding.bottom,e=i.settings.legend.padding.bottom*-1),i.draw_legend.width(i.settings.outerWidth).dmove(s,n);var a=0;for(var l in i.options.dataset)!function(){var t=i.options.dataset[l];if(t.name){var s=t.classname||t.name.toLowerCase().replace(/ /g,"_"),e=t.color||"black",n=t.width||2;t.__legend=i.draw_legend.group().addClass(i.settings["class"]+"__legend__row chartress__legend--"+s).attr("plot-name",s);var d=t.name,g=t.__legend.text(d).fill(e).font({family:i.settings.fontFamily}),r=(parseInt(o(g.node).width)+40)*-1-5,p=parseInt(o(g.node).height)*a-9;g.dx(r),g.dy(p);var c=t.rad||6,f=parseInt(o(g.node).height)/2+1,_=parseInt(o(g.node).height)*a+f,h=[[-35,_],[-5,_]],x=t.__legend.polyline(h).fill("none").stroke({color:e,width:n}).addClass(i.settings["class"]+"__line chartress__legend__line chartress__legend__line--"+s);t.dash&&x.attr("stroke-dasharray",t.dash),t.__legend.circle(c).stroke({width:n,color:e}).fill("white").dx(0-c/2-5).dy(_-c/2).addClass(i.settings["class"]+"__dot chartress__legend__dot--"+s),t.__legend.mouseover(function(){t.__plotgroup.addClass(i.settings["class"]+"__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass(i.settings["class"]+"__plot--hover")}),a++}}()},i.drawColumns=function(){i.draw_columns=[],a++;for(var t=i.settings.width/a,s=0;s<a;s++){i.draw_columns[s]=i.draw.group().addClass(i.settings["class"]+"__columns__group "+i.settings["class"]+"__columns__group--"+s);var e=t*s+i.settings.padding.left,n=i.settings.columns.labels.y,o=0;for(var l in i.options.dataset){var d=i.options.dataset[l];i.log(d);var g=d.name||(s+1).toString();"object"==typeof g&&(g=g[s]);var r=d.color||"#222",p=d.textColor||r,c=d.classname||g.replace(/ /g,"_").toLowerCase(),f=i.settings.columns.width,_=i.settings.columns.space,h=d.__plot[s]/i.settings.largestcolumn*i.settings.height,x=i.options.dataset.length*-.5+.5+o,u=x*(f+_);i.log([x,u]),i.draw_columns[s].text(g).fill(p).dx(e+t/2+u).dy(i.settings.height+n+i.settings.padding.top).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.columns.labels.fontsize}).addClass(i.settings["class"]+"__columns__label "+i.settings["class"]+"__columns__label--"+c),i.draw_columns[s].rect(f,h).fill(r).dx(e+t/2+u-f/2).dy(i.settings.height-h+i.settings.padding.top).addClass(i.settings["class"]+"__columns__column "+i.settings["class"]+"__columns__column--"+c),o++}}},i.drawPies=function(){var t=0;i.pies={},i.draw_pie=i.draw.group().addClass(i.settings["class"]+"__pies");var s=i.settings.width<i.settings.height?i.settings.width:i.settings.height,e=i.settings.width/2-s/2+i.settings.rect.left,n=i.settings.height/2-s/2+i.settings.rect.top,o=i.options.pie.total||"count",a=0;if("count"===o){o=0;for(var l in i.options.dataset){var d=i.options.dataset[l];o+=d.value}}var g;for(var l in i.options.dataset)!function(){var d=i.options.dataset[l],r=0,p=-90+r;"number"==typeof d.position?(d.position>1&&(d.position=d.position/100),r=360*d.position):0!==a&&(r=a/o*360),"number"!=typeof d.position&&(a+=d.value),p=-90+r;var c=d.classname||"noclass-"+t,f=s;"undefined"!=typeof d.width&&(f=d.width),i.pies[c]={},i.pies[c].el=i.draw_pie.circle(s),i.pies[c].el.attr("stroke-dasharray","20,10").fill("transparent").addClass(i.settings["class"]+"__pie").dx(e).dy(n).stroke({width:f,color:d.color||"#aaa"});var _=2*Math.PI*(s/2);i.pies[c].el.attr("stroke-dasharray","0,"+_),i.pies[c].el.rotate(p),d.mask!==!1&&(g=i.draw_pie.circle(s).fill({color:"white"}).dx(e).dy(n),i.pies[c].el.maskWith(g));var h=nv*_/o;i.pies[c].el.attr("stroke-dasharray",h+","+_),i.pies[c].el.addClass(i.settings["class"]+"__pie--"+c),t++}();var r=i.settings.pie.title||!1;if(r.text!==!1){i.draw_pie_title=i.draw_pie.group().addClass(i.settings["class"]+"__pie__title");var p=i.draw_pie_title.text(r.text).addClass(i.settings["class"]+"__pie__title--main").font({family:i.settings.fontFamily,size:r.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2+i.settings.padding.top-.9*r.size);r.bold&&p.font({family:i.settings.fontFamily,weight:"bold"});var c=r.pre||!1;c&&(pretext=i.draw_pie_title.text(c.text).addClass(i.settings["class"]+"__pie__title--pre").font({family:i.settings.fontFamily,size:c.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2-r.size/2-c.size-5+i.settings.padding.top));var f=r.sub||!1;f&&(subText=i.draw_pie_title.text(f.text).addClass(i.settings["class"]+"__pie__title--sub").font({family:i.settings.fontFamily,size:f.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2+r.size/2.5+i.settings.padding.top))}},i.drawChart=function(){i.clear(),i.setBounds(),"line"===i.settings.type&&(i.drawLabels(),i.drawLines(),i.drawLegend()),"column"===i.settings.type&&(i.drawLabels(),i.drawColumns()),"pie"===i.settings.type&&i.drawPies(),setTimeout(function(){i.draw.spof()})},i.canvasResize=function(){i.draw.spof(),i.drawChart()};var l,d=[parseInt(o(n).width),parseInt(o(n).height)];return SVG.on(window,"resize",function(){d[0]===parseInt(o(n).width)&&d[1]===parseInt(o(n).height)||(clearTimeout(l),l=setTimeout(i.canvasResize,i.options.graph.redrawTimeout||0))}),i.drawToCanvas=function(s){var e=t.querySelector("svg"),n=s.getContext("2d");n.canvas.width=i.settings.outerWidth,n.canvas.height=i.settings.outerHeight;var o=new Image,a=(new XMLSerializer).serializeToString(e),l=btoa(a),d="data:image/svg+xml;base64,",g=d+l;o.src=g,n.drawImage(o,0,0)},i.drawChart(),i};