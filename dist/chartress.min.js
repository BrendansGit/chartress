window.chartress=function(s,t){function e(s,t){return t-s}var i=s;"undefined"!=typeof jQuery&&s instanceof jQuery&&(i=i[0]);var a={};a.settings={yMax:0},a.options=t,a.draw=SVG(i).size("100%","100%").spof(),a.clear=function(){a.draw.clear()},"undefined"==typeof a.options.graph&&(a.options.graph={}),"undefined"==typeof a.options.graph.padding&&(a.options.graph.padding=[]),a.settings.padding={top:a.options.graph.padding[0]||0,right:a.options.graph.padding[1]||0,bottom:a.options.graph.padding[2]||0,left:a.options.graph.padding[3]||0},a.settings.type=a.options.type||"normal",a.setBounds=function(){if("normal"===a.settings.type)for(var s in a.options.lines){var t=a.options.lines[s],n=t.plot.slice(0);n.length>a.options.xAxis.maxRangeLength&&(n.reverse(),n.length=a.options.xAxis.maxRangeLength,n.reverse()),t.__plot=n.slice(0),n.sort(e),a.settings.yMax<n[0]&&(a.settings.yMax=n[0])}if("pipes"===a.settings.type){a.settings.largestPipe=0;for(var s in a.options.lines){var t=a.options.lines[s];a.settings.largestPipe<t.value&&(a.settings.largestPipe=t.value)}}if("pie"===a.settings.type&&(a.settings.pie={},a.settings.pie.total=a.options.pie.total||!1,a.settings.pie.total===!1))for(var s in a.options.lines){var t=a.options.lines[s];a.settings.pie.total+=t.value}a.settings.outweWidth=i.scrollWidth,a.settings.width=i.scrollWidth-a.settings.padding.right-a.settings.padding.left,a.settings.outerHeight=i.scrollHeight,a.settings.height=i.scrollHeight-a.settings.padding.top-a.settings.padding.bottom,a.settings.rect={top:a.settings.padding.top,left:a.settings.padding.left,right:a.settings.padding.left+a.settings.width,bottom:a.settings.outerHeight-a.settings.padding.bottom}},a.drawLabels=function(){var s,t=0;for(s=0;s<a.settings.yMax+a.options.yAxis.markEvery;s++)s%a.options.yAxis.markEvery===0&&t++;for(a.yLabels=a.draw.group().addClass("chartress__labels chartress__labels--yAxis"),a.settings.yPoints=[],s=0;s<t;s++){var e=1-(s+1)/t,i=(a.settings.height+.146*a.settings.height)*e+a.settings.padding.top,n=s*a.options.yAxis.markEvery;if(0!==n){var o=a.yLabels.text(n.toString()).fill(a.options.yAxis.label.color).font({family:a.options.graph.fontFamily||"Helvetica",anchor:"middle",size:14}).dx(a.settings.rect.left+a.options.yAxis.label.x).dy(i).addClass("chartress__labels__label chartress__labels__label--yAxis");o.dy(o.node.scrollHeight/2*-1),a.settings.yPoints.push(i)}}var r=(a.settings.longestLine,a.options.xAxis.range.to-a.options.xAxis.range.from);for(a.settings.xPoints=[],a.xLabels=a.draw.group().addClass("chartress__labels chartress__labels--xAxis"),s=0;s<=r;s++){var l=a.options.xAxis.range.from+s;l<10&&(l="0"+l);var n=l+":00",e=s/r,d=a.settings.width*e+a.settings.padding.left;s%a.options.xAxis.markEvery===0&&a.xLabels.text(n).fill(a.options.xAxis.label.color).font({family:a.options.graph.fontFamily||"Helvetica",anchor:"middle",size:14}).dx(d).dy(a.settings.rect.bottom+a.options.xAxis.label.y).addClass("chartress__labels__label chartress__labels--xAxis"),a.settings.xPoints.push(d)}},a.drawLines=function(){a.draw_plots=a.draw.group().addClass("chartress__plots");for(var s in a.options.lines){var t=a.options.lines[s],e=0,i=[];t.__plotgroup=a.draw_plots.group(),t.__plotgroup.addClass("chartress__plot chartress__plot--"+t.classname).attr("plot-name",t.classname);for(var s in t.__plot){var n=t.__plot[s],o=a.settings.xPoints[e],r=a.settings.height-n/a.settings.yMax*a.settings.height+a.settings.padding.top;i.push([o,r]),e++}t.__plotsvg=t.__plotgroup.polyline(i).fill("none").stroke({width:2}).addClass("chartress__line chartress__line--"+t.classname),t.dash&&t.__plotsvg.attr("stroke-dasharray",t.dash);var l=t.rad;for(var s in i){var n=i[s];t.__plotgroup.circle(l).dx(n[0]-l/2).dy(n[1]-l/2).addClass("chartress__dot chartress__dot--"+t.classname)}}},a.drawLegend=function(){a.draw_legend=a.draw.group().addClass("chartress__legend").font({family:a.options.graph.fontFamily||"Helvetica",size:13});var s=0,t=a.settings.outweWidth/100*a.options.legend.x;a.options.legend.x>50?(t-=a.options.legend.padding[1],s=a.options.legend.padding[1]*-1):(t+=a.options.legend.padding[3],s=a.options.legend.padding[3]);var e=0,i=a.settings.outerHeight/100*a.options.legend.y;a.options.legend.y<50?(i+=a.options.legend.padding[0],e=a.options.legend.padding[0]):(i-=a.options.legend.padding[2],e=a.options.legend.padding[2]*-1),a.draw_legend.width(a.settings.outweWidth).dmove(t,i);var n=0;for(var o in a.options.lines){var r=a.options.lines[o];r.__legend=a.draw_legend.group().addClass("chartress__legend__row chartress__legend--"+r.classname).attr("plot-name",r.classname);var l=r.name,d=r.__legend.text(l).font({family:a.options.graph.fontFamily||"Helvetica"}),p=(d.node.scrollWidth+40)*-1,g=d.node.scrollHeight*n*1.1;d.dx(p),d.dy(g);var h=r.rad,_=1.1*d.node.scrollHeight*.2,c=[[-30,e+(d.node.scrollHeight-_)+g],[0,e+(d.node.scrollHeight-_)+g]],f=r.__legend.polyline(c).fill("none").stroke({width:2}).addClass("chartress__line chartress__legend__line chartress__legend__line--"+r.classname);r.dash&&f.attr("stroke-dasharray",r.dash),r.__legend.circle(h).dx(0-h/2).dy(e+(d.node.scrollHeight-_)+g-h/2).addClass("chartress__dot chartress__legend__dot--"+r.classname),r.__legend.mouseover(function(){r.__plotgroup.addClass("chartress__plot--hover")}).mouseout(function(){r.__plotgroup.removeClass("chartress__plot--hover")}),n++}},a.drawPipes=function(){var s=0;a.draw_pipes={labels:a.draw.group().addClass("chartress__pipes__labels"),pipes:a.draw.group().addClass("chartress__pipes__pipes")};for(var t in a.options.lines){var e=a.options.lines[t],i=100/a.options.lines.length/100*s,n=a.settings.width/a.options.lines.length,o=i*a.settings.width+n-n/2,r=a.options.pipes.width||10,l=e.value/a.settings.largestPipe*a.settings.height,d=a.options.pipes.labels.y||0;a.draw_pipes.labels.text(e.name).fill("#000").font({family:a.options.graph.fontFamily||"Helvetica",anchor:"middle",size:a.options.pipes.labels.fontsize||14}).dx(o+a.settings.padding.left).dy(a.settings.height+d+a.settings.padding.top).addClass("chartress__pipes__label"),a.draw_pipes.pipes.rect(r,l).dx(o-r/2+a.settings.padding.left).dy(a.settings.height-l+a.settings.padding.top).addClass("chartress__pipes__pipe"),s++}},a.drawPies=function(){var s=0;a.pies={},a.draw_pie=a.draw.group().addClass("chartress__pies");var t,e=a.settings.width<a.settings.height?a.settings.width:a.settings.height,i=a.settings.width/2-e/2+a.settings.rect.left,n=a.settings.height/2-e/2+a.settings.rect.top;for(var o in a.options.lines)!function(){var r=a.options.lines[o],l=e;"undefined"!=typeof r.width&&(l=r.width),a.pies[r.classname]={},a.pies[r.classname].el=a.draw_pie.circle(e),a.pies[r.classname].el.attr("stroke-dasharray","20,10").fill("transparent").addClass("chartress__pie").dx(i).dy(n).stroke({width:l}).rotate(-90);var d=2*Math.PI*(e/2);a.pies[r.classname].el.attr("stroke-dasharray","0,"+d),r.mask!==!1&&(t=a.draw_pie.circle(e).fill({color:"white"}).dx(i).dy(n),a.pies[r.classname].el.maskWith(t)),a.pies[r.classname].set=function(s){var t=s*d/100;a.pies[r.classname].el.attr("stroke-dasharray",t+","+d)},setTimeout(function(){a.pies[r.classname].set(r.value),a.pies[r.classname].el.addClass("chartress__pie--"+r.classname)}),s++}();var r=a.options.pie.title||!1;if(r){a.draw_pie_title=a.draw_pie.group().addClass("chartress__pie__title");var l=a.draw_pie_title.text(r.text).addClass("chartress__pie__title--main").font({family:a.options.graph.fontFamily||"Helvetica",size:r.size,anchor:"middle"}).dx(a.settings.width/2).dy(a.settings.height/2);r.bold&&l.font({family:a.options.graph.fontFamily||"Helvetica",weight:"bold"}),l.dy(l.node.scrollHeight*-.9);var d=r.pre||!1;d&&(pretext=a.draw_pie_title.text(d.text).addClass("chartress__pie__title--pre").font({family:a.options.graph.fontFamily||"Helvetica",size:d.size,anchor:"middle"}).dx(a.settings.width/2).dy(a.settings.height/2-l.node.scrollHeight/2),pretext.dy(pretext.node.scrollHeight*-1.8));var p=r.sub||!1;p&&(subText=a.draw_pie_title.text(p.text).addClass("chartress__pie__title--sub").font({family:a.options.graph.fontFamily||"Helvetica",size:p.size,anchor:"middle"}).dx(a.settings.width/2).dy(a.settings.height/2+.11*a.settings.height))}},a.drawGraph=function(){a.clear(),a.setBounds(),"normal"===a.settings.type&&(a.drawLabels(),a.drawLines(),a.drawLegend()),"pipes"===a.settings.type&&a.drawPipes(),"pie"===a.settings.type&&a.drawPies()},a.canvasResize=function(){a.draw.spof(),a.drawGraph()};var n,o=[i.scrollWidth,i.scrollHeight];return SVG.on(window,"resize",function(){o[0]===i.scrollWidth&&o[1]===i.scrollHeight||(clearTimeout(n),n=setTimeout(a.canvasResize,a.options.graph.redrawTimeout||100))}),a.drawGraph(),a};