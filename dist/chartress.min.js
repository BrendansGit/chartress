window.chartress=function(t,s){function e(t,s){return s-t}var i={};"undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t[0]);var n=t,a=document.createElement("div");n.appendChild(a),a.className="chartress",a.style.height="100%",a.style.width="100%",i.options=s,i.settings={},i.draw=SVG(a).size("100%","100%").spof(),i.clear=function(){i.draw.clear()},i.options.debug===!0&&(console.info("chartress debug enabled for "),console.info(a),console.info("Passed Data: "),console.info(i.options),console.log("------"));for(var o=function(t){return"undefined"==typeof t},l=[["graph"],["graph.padding"],["graph.padding.left",0],["graph.padding.right",0],["graph.padding.top",0],["graph.padding.bottom",0],["xAxis"],["xAxis.range"],["xAxis.range.from",0],["xAxis.range.to",null],["xAxis.legend"],["xAxis.legend.x"],["xAxis.legend.y"],["xAxis.lines"],["xAxis.lines.color","#0f0"],["xAxis.lines.width",1],["xAxis.label"],["xAxis.label.markEvery",1],["xAxis.label.markCount",null],["xAxis.label.color","gray"],["xAxis.label.y",0],["xAxis.label.position","bottom"],["xAxis.label.size",14],["yAxis"],["yAxis.lines"],["yAxis.lines.color","#00f"],["yAxis.lines.width",1],["yAxis.label"],["yAxis.label.markEvery",null],["yAxis.label.markCount",4],["yAxis.label.color","gray"],["yAxis.label.x",0],["legend"],["legend.x",100],["legend.y",0],["legend.padding"],["legend.padding.top",0],["legend.padding.right",0],["legend.padding.bottom",0],["legend.padding.left",0],["columns"],["columns.width",40],["columns.space",1],["columns.labels"],["columns.labels.fontSize",16],["columns.labels.y",1],["pie"],["pie.total",100],["pie.title"],["pie.title.size",50],["pie.title.bold",!0],["pie.title.text",!1],["pie.title.pre"],["pie.title.pre.text",!1],["pie.title.pre.size",14],["pie.title.sub"],["pie.title.sub.text",!1],["pie.title.sub.size",14],["maxLength",null],["yMax",0],["fontFamily","Helvetica"],["class","chartress"],["type","line"]],g=0;g<l.length;g++){var r=l[g][0].split("."),d={};o(l[g][1])||(d=l[g][1]);i.options;1===r.length&&(o(i.options[r[0]])?(i.options[r[0]]=d,i.settings[r[0]]=d):i.settings[r[0]]=i.options[r[0]]),2===r.length&&(o(i.options[r[0]][r[1]])?(i.options[r[0]][r[1]]=d,i.settings[r[0]][r[1]]=d):i.settings[r[0]][r[1]]=i.options[r[0]][r[1]]),3===r.length&&(o(i.options[r[0]][r[1]][r[2]])?(i.options[r[0]][r[1]][r[2]]=d,i.settings[r[0]][r[1]][r[2]]=d):i.settings[r[0]][r[1]][r[2]]=i.options[r[0]][r[1]][r[2]])}o(i.options.yAxis.label.format)&&(i.options.yAxis.label.format=function(t){return t}),o(i.options.xAxis.label.format)&&(i.options.xAxis.label.format=function(t){return t}),i.log=function(t){i.options.debug===!0&&console.log(t)};var p=function(t){return getComputedStyle(t)};"line"===i.settings.type&&(i.settings.graph.padding={top:i.options.graph.padding.top||10,right:i.options.graph.padding.right||8,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35}),"column"===i.settings.type&&(i.settings.graph.padding={top:i.options.graph.padding.top||25,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35},i.settings.xAxis.label.pos=i.options.xAxis.label.position||"top",i.settings.xAxis.label.y=i.options.xAxis.label.y||-5),i.setBounds=function(){if("line"===i.settings.type||"column"==i.settings.type){var t=0;for(var s in i.options.dataset)!function(){var n=i.options.dataset[s],a=n.plot.slice(0);null!==i.settings.maxLength&&a.length>i.settings.maxLength&&(a.reverse(),a.length=i.settings.maxLength,a.reverse()),a.length>t&&(t=a.length),n.__plot=a.slice(0),a.sort(e),i.settings.yMax<a[0]&&(i.settings.yMax=a[0])}();i.settings.maxLength=t,null===i.settings.xAxis.range.to&&(i.settings.xAxis.range.to=t)}if("column"===i.settings.type){i.settings.largestcolumn=0;for(var s in i.options.dataset)for(var n=i.options.dataset[s],o=0;o<n.__plot.length;o++){var l=n.__plot[o];i.settings.largestcolumn<l&&(i.settings.largestcolumn=l)}}if("pie"===i.settings.type&&(i.settings.pie.total=i.options.pie.total||!1,i.settings.pie.total===!1))for(var s in i.options.dataset){var n=i.options.dataset[s];i.settings.pie.total+=n.value}i.settings.outerWidth=parseInt(p(a).width),i.settings.width=i.settings.outerWidth-i.settings.graph.padding.right-i.settings.graph.padding.left,i.settings.outerHeight=parseInt(p(a).height),i.settings.height=i.settings.outerHeight-i.settings.graph.padding.top-i.settings.graph.padding.bottom,i.settings.rect={top:i.settings.graph.padding.top,left:i.settings.graph.padding.left,right:i.settings.graph.padding.left+i.settings.width,bottom:i.settings.outerHeight-i.settings.graph.padding.bottom},i.options.debug===!0&&i.draw.rect(i.settings.width,i.settings.height).fill("#eee").dx(i.settings.rect.left).dy(i.settings.rect.top)},i.drawLabels=function(){null===i.settings.yAxis.label.markEvery&&(i.settings.yAxis.label.markEvery=Math.round(i.settings.yMax/i.settings.yAxis.label.markCount));var t,s=[];for(t=0;t<i.settings.yMax+i.settings.yAxis.label.markEvery;t++){var e=t%i.settings.yAxis.label.markEvery;0===e&&t<=i.settings.yMax&&s.push(t)}for(s[s.length-1]=i.settings.yMax,i.yLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--yAxis"),i.settings.yPoints=[],t=0;t<s.length;t++)!function(){var e=(1-s[t]/i.settings.yMax*i.settings.height)*-1+i.settings.graph.padding.top,n=14;e-=n/3;var a=s[s.length-1-t];a=i.options.yAxis.label.format(a),a=a.toString();var o=i.yLabels.text(a).fill(i.settings.yAxis.label.color).font({family:i.settings.fontFamily,size:n}).dx(i.settings.rect.left+i.settings.yAxis.label.x).dy(e).addClass(i.settings["class"]+"__labels__label chartress__labels__label--yAxis");o.dx(parseInt(p(o.node).width)*-1-10),o.dy(parseInt(p(o.node).height)/2*-1),i.settings.yPoints.push(e)}();var n=(i.settings.longestLine,i.settings.xAxis.range.to-i.settings.xAxis.range.from);null!==i.settings.maxLength&&(n=i.settings.maxLength),i.settings.xPoints=[];var a=0;if("column"===i.settings.type&&(n++,a=i.settings.width/n/2),i.options.xAxis.visible!==!1&&i.options.xAxis.lines!==!1){var o=0;for(i.options.xAxis.maxRangeLength&&(o=i.options.xAxis.maxRangeLength+1),i.xLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--xAxis"),t=0;t<n;t++)!function(){var s=i.settings.xAxis.range.from+t+o;s=i.options.xAxis.label.format(s),s=s.toString();var e=t/(n-1),l=i.settings.width*e+i.settings.graph.padding.left,g=i.settings.rect.bottom+i.settings.xAxis.label.y;"top"===i.settings.xAxis.label.pos&&(g=i.settings.rect.top-1.5*i.settings.xAxis.label.size+i.settings.xAxis.label.y),t%i.settings.xAxis.label.markEvery===0&&i.options.xAxis.visible!==!1&&i.xLabels.text(s).fill(i.settings.xAxis.label.color).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.xAxis.label.size}).dx(l+a).dy(g).addClass(i.settings["class"]+"__labels__label chartress__labels--xAxis"),i.settings.xPoints.push(l)}()}},i.drawLines=function(){i.draw_plots=i.draw.group().addClass(i.settings["class"]+"__plots");for(var t in i.options.dataset){var s=i.options.dataset[t],e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),n=s.color||"black",a=s.width||2,o=[];s.__plotgroup=i.draw_plots.group(),s.__plotgroup.addClass(i.settings["class"]+"__plot chartress__plot--"+e).attr("plot-name",e);var l=0;for(var t in s.__plot)!function(){var e=s.__plot[t],n=l/(i.settings.maxLength-1)*i.settings.width+i.settings.graph.padding.left,a=e/i.settings.yMax*i.settings.height;a=i.settings.height-a+i.settings.graph.padding.top,o.push([n,a]),l++}();s.__plotsvg=s.__plotgroup.polyline(o).fill("none").stroke({color:n,width:a}).addClass(i.settings["class"]+"__line chartress__line--"+e),s.dash&&s.__plotsvg.attr("stroke-dasharray",s.dash);var g=s.rad||6;for(var t in o)!function(){var l=o[t];s.__plotgroup.circle(g).dx(l[0]-g/2).dy(l[1]-g/2).addClass(i.settings["class"]+"__dot chartress__dot--"+e).stroke({color:n,width:a}).fill("white")}()}},i.drawColumns=function(){i.draw_columns=[];for(var t=i.settings.maxLength,s=i.settings.width/t,e=0;e<t;e++){i.draw_columns[e]=i.draw.group().addClass(i.settings["class"]+"__columns__group "+i.settings["class"]+"__columns__group--"+e);var n=s*e+i.settings.graph.padding.left,a=i.settings.columns.labels.y,o=0;for(var l in i.options.dataset){var g=i.options.dataset[l];i.log(g);var r=g.name||(e+1).toString();"object"==typeof r&&(r=r[e]);var d=g.color||"#222",p=g.textColor||d,h=g.classname||r.replace(/ /g,"_").toLowerCase(),c=i.settings.columns.width,x=i.settings.columns.space,_=g.__plot[e]/i.settings.largestcolumn*i.settings.height,u=i.options.dataset.length*-.5+.5+o,f=u*(c+x);i.log([u,f]),i.draw_columns[e].text(r).fill(p).dx(n+s/2+f).dy(i.settings.height+a+i.settings.graph.padding.top).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.columns.labels.fontsize}).addClass(i.settings["class"]+"__columns__label "+i.settings["class"]+"__columns__label--"+h),i.draw_columns[e].rect(c,_).fill(d).dx(n+s/2+f-c/2).dy(i.settings.height-_+i.settings.graph.padding.top).addClass(i.settings["class"]+"__columns__column "+i.settings["class"]+"__columns__column--"+h),o++}}},i.drawPies=function(){var t=0;i.pies={},i.draw_pie=i.draw.group().addClass(i.settings["class"]+"__pies");var s=i.settings.width<i.settings.height?i.settings.width:i.settings.height,e=i.settings.width/2-s/2+i.settings.rect.left,n=i.settings.height/2-s/2+i.settings.rect.top,a=i.options.pie.total||"count",o=0;if("count"===a){a=0;for(var l in i.options.dataset){var g=i.options.dataset[l];a+=g.value}}var r;for(var l in i.options.dataset)!function(){var g=i.options.dataset[l],d=0,p=-90+d;"number"==typeof g.position?(g.position>1&&(g.position=g.position/100),d=360*g.position):0!==o&&(d=o/a*360),"number"!=typeof g.position&&(o+=g.value),p=-90+d;var h=g.classname||"noclass-"+t,c=s;"undefined"!=typeof g.width&&(c=g.width),i.pies[h]={},i.pies[h].el=i.draw_pie.circle(s),i.pies[h].el.attr("stroke-dasharray","20,10").fill("transparent").addClass(i.settings["class"]+"__pie").dx(e).dy(n).stroke({width:c,color:g.color||"#aaa"});var x=2*Math.PI*(s/2);i.pies[h].el.attr("stroke-dasharray","0,"+x),i.pies[h].el.rotate(p),g.mask!==!1&&(r=i.draw_pie.circle(s).fill({color:"white"}).dx(e).dy(n),i.pies[h].el.maskWith(r));var _=g.value*x/a;i.pies[h].el.attr("stroke-dasharray",_+","+x),i.pies[h].el.addClass(i.settings["class"]+"__pie--"+h),t++}();var d=i.settings.pie.title;if(i.log(d),d.text!==!1){i.draw_pie_title=i.draw_pie.group().addClass(i.settings["class"]+"__pie__title");var p=i.draw_pie_title.text(d.text).addClass(i.settings["class"]+"__pie__title--main").font({family:i.settings.fontFamily,size:d.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.graph.padding.left).dy(i.settings.height/2+i.settings.graph.padding.top-.9*d.size);d.bold&&p.font({family:i.settings.fontFamily,weight:"bold"});var h=d.pre;d.pre.text&&(pretext=i.draw_pie_title.text(h.text).addClass(i.settings["class"]+"__pie__title--pre").font({family:i.settings.fontFamily,size:h.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.graph.padding.left).dy(i.settings.height/2-d.size/2-h.size-5+i.settings.graph.padding.top));var c=d.sub;d.sub.text&&(subText=i.draw_pie_title.text(c.text).addClass(i.settings["class"]+"__pie__title--sub").font({family:i.settings.fontFamily,size:c.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.graph.padding.left).dy(i.settings.height/2+d.size/2.5+i.settings.graph.padding.top))}},i.drawLegend=function(){i.draw_legend=i.draw.group().addClass(i.settings["class"]+"__legend").font({family:i.settings.fontFamily,size:12});var t=0,s=i.settings.outerWidth/100*i.settings.legend.x;i.settings.legend.x>50?(s-=i.settings.legend.padding.right,t=i.settings.legend.padding.right*-1):(s+=i.settings.legend.padding.left,t=i.settings.legend.padding.left);var e=0,n=i.settings.outerHeight/100*i.settings.legend.y;i.settings.legend.y<50?(n+=i.settings.legend.padding.top,e=i.settings.legend.padding.top):(n-=i.settings.legend.padding.bottom,e=i.settings.legend.padding.bottom*-1),i.draw_legend.width(i.settings.outerWidth).dmove(s,n);var a=0;for(var o in i.options.dataset)!function(){var t=i.options.dataset[o];if(t.name){var s=t.classname||t.name.toLowerCase().replace(/ /g,"_"),e=t.color||"black",n=t.width||2;t.__legend=i.draw_legend.group().addClass(i.settings["class"]+"__legend__row chartress__legend--"+s).attr("plot-name",s);var l=t.name,g=t.__legend.text(l).fill(e).font({family:i.settings.fontFamily}),r=(parseInt(p(g.node).width)+40)*-1-5,d=parseInt(p(g.node).height)*a-9;g.dx(r),g.dy(d);var h=t.rad||6,c=parseInt(p(g.node).height)/2+1,x=parseInt(p(g.node).height)*a+c,_=[[-35,x],[-5,x]],u=t.__legend.polyline(_).fill("none").stroke({color:e,width:n}).addClass(i.settings["class"]+"__line chartress__legend__line chartress__legend__line--"+s);t.dash&&u.attr("stroke-dasharray",t.dash),t.__legend.circle(h).stroke({width:n,color:e}).fill("white").dx(0-h/2-5).dy(x-h/2).addClass(i.settings["class"]+"__dot chartress__legend__dot--"+s),t.__legend.mouseover(function(){t.__plotgroup.addClass(i.settings["class"]+"__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass(i.settings["class"]+"__plot--hover")}),a++}}()},i.drawChart=function(){i.clear(),i.setBounds(),"line"===i.settings.type&&(i.drawLabels(),i.drawLines(),i.drawLegend()),"column"===i.settings.type&&(i.drawLabels(),i.drawColumns()),"pie"===i.settings.type&&i.drawPies(),setTimeout(function(){i.draw.spof()})},i.canvasResize=function(){i.drawChart(),i.draw.spof()};var h,c=[parseInt(p(a).width),parseInt(p(a).height)];return SVG.on(window,"resize",function(){c[0]===parseInt(p(a).width)&&c[1]===parseInt(p(a).height)||(clearTimeout(h),h=setTimeout(i.canvasResize,i.options.graph.redrawTimeout||5))}),i.drawToCanvas=function(s){var e=t.querySelector("svg"),n=s.getContext("2d");n.canvas.width=i.settings.outerWidth,n.canvas.height=i.settings.outerHeight;var a=new Image,o=(new XMLSerializer).serializeToString(e),l=btoa(o),g="data:image/svg+xml;base64,",r=g+l;a.src=r,n.drawImage(a,0,0)},i.drawChart(),i};