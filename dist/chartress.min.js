window.chartress=function(t,s){function e(t,s){return s-t}var i={};"undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t[0]);var n=t,o=document.createElement("div");n.appendChild(o),o.className="chartress",o.style.height="100%",o.style.width="100%",i.options=s,i.draw=SVG(o).size("100%","100%").spof(),i.clear=function(){i.draw.clear()},i.options.debug===!0&&(console.info("chartress debug enabled for "),console.info(o),console.info("Passed Data: "),console.info(i.options),console.log("------")),"undefined"==typeof i.options.graph&&(i.options.graph={}),"undefined"==typeof i.options.xAxis&&(i.options.xAxis={}),"undefined"==typeof i.options.xAxis.range&&(i.options.xAxis.range={}),"undefined"==typeof i.options.xAxis.legend&&(i.options.xAxis.legend={}),"undefined"==typeof i.options.yAxis&&(i.options.yAxis={}),"undefined"==typeof i.options.yAxis.label&&(i.options.yAxis.label={}),"undefined"==typeof i.options.legend&&(i.options.legend={}),"undefined"==typeof i.options.yAxis.label.format&&(i.options.yAxis.label.format=function(t){return t}),"undefined"==typeof i.options.xAxis.label&&(i.options.xAxis.label={}),"undefined"==typeof i.options.xAxis.label.format&&(i.options.xAxis.label.format=function(t){return t}),"undefined"==typeof i.options.legend.padding&&(i.options.legend.padding={}),"undefined"==typeof i.options.graph.padding&&(i.options.graph.padding={}),"undefined"==typeof i.options.columns&&(i.options.columns={}),"undefined"==typeof i.options.columns.labels&&(i.options.columns.labels={}),"undefined"==typeof i.options.pie&&(i.options.pie={}),"undefined"==typeof i.options.pie.title&&(i.options.pie.title={}),i.log=function(t){i.options.debug===!0&&console.log(t)};var a=function(t){return getComputedStyle(t)};i.settings={maxLength:i.options.xAxis.maxRangeLength||null,yMax:0,fontSize:i.options.graph.fontFamily||"Helvetica","class":i.options.graph.class_prefix||"chartress",padding:{top:i.options.graph.padding.top||0,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||0,left:i.options.graph.padding.left||0},type:i.options.type||"line",yAxis:{markEvery:i.options.yAxis.markEvery||1,label:{color:i.options.yAxis.label.color||"gray",x:i.options.yAxis.label.x||0},markEvery:i.options.yAxis.markEvery||20},xAxis:{range:{from:i.options.xAxis.range.from||0,to:i.options.xAxis.range.to||null},markEvery:i.options.xAxis.markEvery||1,label:{color:i.options.xAxis.label.color||"gray",y:i.options.xAxis.label.y||0,pos:i.options.xAxis.label.position||"bottom",size:i.options.xAxis.label.size||14}},legend:{x:i.options.legend.x||100,y:i.options.legend.x||0,padding:{top:i.options.legend.padding.top||0,right:i.options.legend.padding.right||0,bottom:i.options.legend.padding.bottom||0,left:i.options.legend.padding.left||0}},columns:{width:i.options.columns.width||40,space:i.options.columns.space||4,labels:{fontSize:i.options.columns.labels.fontSize||16,y:i.options.columns.labels.y||1}},pie:{total:i.options.pie.total||100,red:"blue",title:{size:i.options.pie.title.size||50,bold:i.options.pie.title.bold||!0,text:i.options.pie.title.text||!1,pre:i.options.pie.title.pre||!1,sub:i.options.pie.title.sub||!1}}},"line"===i.settings.type&&(i.settings.padding={top:i.options.graph.padding.top||10,right:i.options.graph.padding.right||8,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35}),"column"===i.settings.type&&(i.settings.padding={top:i.options.graph.padding.top||25,right:i.options.graph.padding.right||0,bottom:i.options.graph.padding.bottom||25,left:i.options.graph.padding.left||35},i.settings.xAxis.label.pos=i.options.xAxis.label.position||"top",i.settings.xAxis.label.y=i.options.xAxis.label.y||-5),i.setBounds=function(){if("line"===i.settings.type||"column"==i.settings.type){var t=0;for(var s in i.options.dataset)!function(){var n=i.options.dataset[s],o=n.plot.slice(0);null!==i.settings.maxLength&&o.length>i.settings.maxLength&&(o.reverse(),o.length=i.settings.maxLength,o.reverse()),o.length>t&&(t=o.length),n.__plot=o.slice(0),o.sort(e),i.settings.yMax<o[0]&&(i.settings.yMax=o[0])}();i.settings.maxLength=t,null===i.settings.xAxis.range.to&&(i.settings.xAxis.range.to=t)}if("column"===i.settings.type){i.settings.largestcolumn=0;for(var s in i.options.dataset)for(var n=i.options.dataset[s],l=0;l<n.__plot.length;l++){var d=n.__plot[l];i.settings.largestcolumn<d&&(i.settings.largestcolumn=d)}}if("pie"===i.settings.type&&(i.settings.pie.total=i.options.pie.total||!1,i.settings.pie.total===!1))for(var s in i.options.dataset){var n=i.options.dataset[s];i.settings.pie.total+=n.value}i.settings.outerWidth=parseInt(a(o).width),i.settings.width=i.settings.outerWidth-i.settings.padding.right-i.settings.padding.left,i.settings.outerHeight=parseInt(a(o).height),i.settings.height=i.settings.outerHeight-i.settings.padding.top-i.settings.padding.bottom,i.settings.rect={top:i.settings.padding.top,left:i.settings.padding.left,right:i.settings.padding.left+i.settings.width,bottom:i.settings.outerHeight-i.settings.padding.bottom},i.options.debug===!0&&i.draw.rect(i.settings.width,i.settings.height).fill("#eee").dx(i.settings.rect.left).dy(i.settings.rect.top)},i.drawLabels=function(){var t,s=[];for(t=0;t<i.settings.yMax+i.settings.yAxis.markEvery;t++)t%i.settings.yAxis.markEvery===0&&s.push(t);for(i.yLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--yAxis"),i.settings.yPoints=[],t=0;t<s.length;t++)!function(){var e=(1-s[t]/i.settings.yMax*i.settings.height)*-1+i.settings.padding.top,n=14;e-=n/3;var o=s[s.length-1-t];o=i.options.yAxis.label.format(o),o=o.toString();var l=i.yLabels.text(o).fill(i.settings.yAxis.label.color).font({family:i.settings.fontFamily,size:n}).dx(i.settings.rect.left+i.settings.yAxis.label.x).dy(e).addClass(i.settings["class"]+"__labels__label chartress__labels__label--yAxis");l.dx(parseInt(a(l.node).width)*-1-10),l.dy(parseInt(a(l.node).height)/2*-1),i.settings.yPoints.push(e)}();var e=(i.settings.longestLine,i.settings.xAxis.range.to-i.settings.xAxis.range.from);null!==i.settings.maxLength&&(e=i.settings.maxLength),i.settings.xPoints=[];var n=0;if("column"===i.settings.type&&(n=i.settings.width/e/2),i.options.xAxis.visible!==!1){var o=0;for(i.options.xAxis.maxRangeLength&&(o=i.options.xAxis.maxRangeLength+1),i.xLabels=i.draw.group().addClass(i.settings["class"]+"__labels chartress__labels--xAxis"),t=0;t<e;t++)!function(){var s=i.settings.xAxis.range.from+t+o;s=i.options.xAxis.label.format(s),s=s.toString();var a=t/(e-1),l=i.settings.width*a+i.settings.padding.left,d=i.settings.rect.bottom+i.settings.xAxis.label.y;"top"===i.settings.xAxis.label.pos&&(d=i.settings.rect.top-1.5*i.settings.xAxis.label.size+i.settings.xAxis.label.y),t%i.settings.xAxis.markEvery===0&&i.xLabels.text(s).fill(i.settings.xAxis.label.color).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.xAxis.label.size}).dx(l+n).dy(d).addClass(i.settings["class"]+"__labels__label chartress__labels--xAxis"),i.settings.xPoints.push(l)}()}},i.drawLines=function(){i.draw_plots=i.draw.group().addClass(i.settings["class"]+"__plots");for(var t in i.options.dataset){var s=i.options.dataset[t],e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),n=s.color||"black",o=s.width||2,a=[];s.__plotgroup=i.draw_plots.group(),s.__plotgroup.addClass(i.settings["class"]+"__plot chartress__plot--"+e).attr("plot-name",e);var l=0;for(var t in s.__plot)!function(){var e=s.__plot[t],n=l/(i.settings.maxLength-1)*i.settings.width+i.settings.padding.left,o=e/i.settings.yMax*i.settings.height;o=i.settings.height-o+i.settings.padding.top,a.push([n,o]),l++}();s.__plotsvg=s.__plotgroup.polyline(a).fill("none").stroke({color:n,width:o}).addClass(i.settings["class"]+"__line chartress__line--"+e),s.dash&&s.__plotsvg.attr("stroke-dasharray",s.dash);var d=s.rad||6;for(var t in a)!function(){var l=a[t];s.__plotgroup.circle(d).dx(l[0]-d/2).dy(l[1]-d/2).addClass(i.settings["class"]+"__dot chartress__dot--"+e).stroke({color:n,width:o}).fill("white")}()}},i.drawLegend=function(){i.draw_legend=i.draw.group().addClass(i.settings["class"]+"__legend").font({family:i.settings.fontFamily,size:12});var t=0,s=i.settings.outerWidth/100*i.settings.legend.x;i.settings.legend.x>50?(s-=i.settings.legend.padding.right,t=i.settings.legend.padding.right*-1):(s+=i.settings.legend.padding.left,t=i.settings.legend.padding.left);var e=0,n=i.settings.outerHeight/100*i.settings.legend.y;i.settings.legend.y<50?(n+=i.settings.legend.padding.top,e=i.settings.legend.padding.top):(n-=i.settings.legend.padding.bottom,e=i.settings.legend.padding.bottom*-1),i.draw_legend.width(i.settings.outerWidth).dmove(s,n);var o=0;for(var l in i.options.dataset)!function(){var t=i.options.dataset[l];if(t.name){var s=t.classname||t.name.toLowerCase().replace(/ /g,"_"),e=t.color||"black",n=t.width||2;t.__legend=i.draw_legend.group().addClass(i.settings["class"]+"__legend__row chartress__legend--"+s).attr("plot-name",s);var d=t.name,g=t.__legend.text(d).fill(e).font({family:i.settings.fontFamily}),r=(parseInt(a(g.node).width)+40)*-1-5,p=parseInt(a(g.node).height)*o-9;g.dx(r),g.dy(p);var h=t.rad||6,c=parseInt(a(g.node).height)/2+1,f=parseInt(a(g.node).height)*o+c,_=[[-35,f],[-5,f]],x=t.__legend.polyline(_).fill("none").stroke({color:e,width:n}).addClass(i.settings["class"]+"__line chartress__legend__line chartress__legend__line--"+s);t.dash&&x.attr("stroke-dasharray",t.dash),t.__legend.circle(h).stroke({width:n,color:e}).fill("white").dx(0-h/2-5).dy(f-h/2).addClass(i.settings["class"]+"__dot chartress__legend__dot--"+s),t.__legend.mouseover(function(){t.__plotgroup.addClass(i.settings["class"]+"__plot--hover")}).mouseout(function(){t.__plotgroup.removeClass(i.settings["class"]+"__plot--hover")}),o++}}()},i.drawColumns=function(){i.draw_columns=[];for(var t=i.settings.maxLength,s=i.settings.width/t,e=0;e<t;e++){i.draw_columns[e]=i.draw.group().addClass(i.settings["class"]+"__columns__group "+i.settings["class"]+"__columns__group--"+e);var n=s*e+i.settings.padding.left,o=i.settings.columns.labels.y,a=0;for(var l in i.options.dataset){var d=i.options.dataset[l];i.log(d);var g=d.name||(e+1).toString();"object"==typeof g&&(g=g[e]);var r=d.color||"#222",p=d.textColor||r,h=d.classname||g.replace(/ /g,"_").toLowerCase(),c=i.settings.columns.width,f=i.settings.columns.space,_=d.__plot[e]/i.settings.largestcolumn*i.settings.height,x=i.options.dataset.length*-.5+.5+a,u=x*(c+f);i.log([x,u]),i.draw_columns[e].text(g).fill(p).dx(n+s/2+u).dy(i.settings.height+o+i.settings.padding.top).font({family:i.settings.fontFamily,anchor:"middle",size:i.settings.columns.labels.fontsize}).addClass(i.settings["class"]+"__columns__label "+i.settings["class"]+"__columns__label--"+h),i.draw_columns[e].rect(c,_).fill(r).dx(n+s/2+u-c/2).dy(i.settings.height-_+i.settings.padding.top).addClass(i.settings["class"]+"__columns__column "+i.settings["class"]+"__columns__column--"+h),a++}}},i.drawPies=function(){var t=0;i.pies={},i.draw_pie=i.draw.group().addClass(i.settings["class"]+"__pies");var s=i.settings.width<i.settings.height?i.settings.width:i.settings.height,e=i.settings.width/2-s/2+i.settings.rect.left,n=i.settings.height/2-s/2+i.settings.rect.top,o=i.options.pie.total||"count",a=0;if("count"===o){o=0;for(var l in i.options.dataset){var d=i.options.dataset[l];o+=d.value}}var g;for(var l in i.options.dataset)!function(){var d=i.options.dataset[l],r=0,p=-90+r;"number"==typeof d.position?(d.position>1&&(d.position=d.position/100),r=360*d.position):0!==a&&(r=a/o*360),"number"!=typeof d.position&&(a+=d.value),p=-90+r;var h=d.classname||"noclass-"+t,c=s;"undefined"!=typeof d.width&&(c=d.width),i.pies[h]={},i.pies[h].el=i.draw_pie.circle(s),i.pies[h].el.attr("stroke-dasharray","20,10").fill("transparent").addClass(i.settings["class"]+"__pie").dx(e).dy(n).stroke({width:c,color:d.color||"#aaa"});var f=2*Math.PI*(s/2);i.pies[h].el.attr("stroke-dasharray","0,"+f),i.pies[h].el.rotate(p),d.mask!==!1&&(g=i.draw_pie.circle(s).fill({color:"white"}).dx(e).dy(n),i.pies[h].el.maskWith(g));var _=d.value*f/o;i.pies[h].el.attr("stroke-dasharray",_+","+f),i.pies[h].el.addClass(i.settings["class"]+"__pie--"+h),t++}();var r=i.settings.pie.title||!1;if(r.text!==!1){i.draw_pie_title=i.draw_pie.group().addClass(i.settings["class"]+"__pie__title");var p=i.draw_pie_title.text(r.text).addClass(i.settings["class"]+"__pie__title--main").font({family:i.settings.fontFamily,size:r.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2+i.settings.padding.top-.9*r.size);r.bold&&p.font({family:i.settings.fontFamily,weight:"bold"});var h=r.pre||!1;h&&(pretext=i.draw_pie_title.text(h.text).addClass(i.settings["class"]+"__pie__title--pre").font({family:i.settings.fontFamily,size:h.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2-r.size/2-h.size-5+i.settings.padding.top));var c=r.sub||!1;c&&(subText=i.draw_pie_title.text(c.text).addClass(i.settings["class"]+"__pie__title--sub").font({family:i.settings.fontFamily,size:c.size,anchor:"middle"}).dx(i.settings.width/2+i.settings.padding.left).dy(i.settings.height/2+r.size/2.5+i.settings.padding.top))}},i.drawChart=function(){i.clear(),i.setBounds(),"line"===i.settings.type&&(i.drawLabels(),i.drawLines(),i.drawLegend()),"column"===i.settings.type&&(i.drawLabels(),i.drawColumns()),"pie"===i.settings.type&&i.drawPies(),setTimeout(function(){i.draw.spof()})},i.canvasResize=function(){i.drawChart(),i.draw.spof()};var l,d=[parseInt(a(o).width),parseInt(a(o).height)];return SVG.on(window,"resize",function(){d[0]===parseInt(a(o).width)&&d[1]===parseInt(a(o).height)||(clearTimeout(l),l=setTimeout(i.canvasResize,i.options.graph.redrawTimeout||5))}),i.drawToCanvas=function(s){var e=t.querySelector("svg"),n=s.getContext("2d");n.canvas.width=i.settings.outerWidth,n.canvas.height=i.settings.outerHeight;var o=new Image,a=(new XMLSerializer).serializeToString(e),l=btoa(a),d="data:image/svg+xml;base64,",g=d+l;o.src=g,n.drawImage(o,0,0)},i.drawChart(),i};